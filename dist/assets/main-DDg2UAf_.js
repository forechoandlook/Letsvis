import{_ as et,r as be,c as ge,o as we,a as b,b as oe,w as Me,d as De,n as Ie,s as Rt,e as tt,u as K,f as yt,g as D,p as fe,h as Y,i as Tt,j as nt,k as st,l as Ot,m as J,A as Ee,q as j,t as _t,v as xt,x as Ct,y as St,z as Pt,B as At,C as Lt,D as bt,F as Mt,E as ie,L as Dt,G as It}from"./lmem-Db9QBJdj.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();const Ht={id:"app"},kt={class:"view-navigation"},Nt={class:"main-content"},Bt={__name:"App",setup(n){return(e,t)=>{const s=be("router-link"),i=be("router-view");return we(),ge("div",Ht,[b("nav",kt,[oe(s,{to:"/lmem",class:Ie(["nav-link",{active:e.$route.name==="lmem"}])},{default:Me(()=>t[0]||(t[0]=[De(" LMEM 可视化 ",-1)])),_:1,__:[0]},8,["class"]),oe(s,{to:"/timestep",class:Ie(["nav-link",{active:e.$route.name==="timestep"}])},{default:Me(()=>t[1]||(t[1]=[De(" Timestep 可视化 ",-1)])),_:1,__:[1]},8,["class"])]),b("main",Nt,[oe(i)])])}}},Wt=et(Bt,[["__scopeId","data-v-27e42e88"]]);/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const X=typeof document<"u";function it(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function Ft(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&it(n.default)}const C=Object.assign;function pe(n,e){const t={};for(const s in e){const i=e[s];t[s]=H(i)?i.map(n):n(i)}return t}const Z=()=>{},H=Array.isArray,ot=/#/g,Gt=/&/g,Yt=/\//g,Xt=/=/g,zt=/\?/g,rt=/\+/g,$t=/%5B/g,Vt=/%5D/g,at=/%5E/g,Ut=/%60/g,lt=/%7B/g,jt=/%7C/g,ct=/%7D/g,qt=/%20/g;function Oe(n){return encodeURI(""+n).replace(jt,"|").replace($t,"[").replace(Vt,"]")}function Kt(n){return Oe(n).replace(lt,"{").replace(ct,"}").replace(at,"^")}function Re(n){return Oe(n).replace(rt,"%2B").replace(qt,"+").replace(ot,"%23").replace(Gt,"%26").replace(Ut,"`").replace(lt,"{").replace(ct,"}").replace(at,"^")}function Zt(n){return Re(n).replace(Xt,"%3D")}function Qt(n){return Oe(n).replace(ot,"%23").replace(zt,"%3F")}function Jt(n){return n==null?"":Qt(n).replace(Yt,"%2F")}function ee(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const en=/\/$/,tn=n=>n.replace(en,"");function me(n,e,t="/"){let s,i={},o="",a="";const l=e.indexOf("#");let r=e.indexOf("?");return l<r&&l>=0&&(r=-1),r>-1&&(s=e.slice(0,r),o=e.slice(r+1,l>-1?l:e.length),i=n(o)),l>-1&&(s=s||e.slice(0,l),a=e.slice(l,e.length)),s=rn(s??e,t),{fullPath:s+(o&&"?")+o+a,path:s,query:i,hash:ee(a)}}function nn(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function He(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function sn(n,e,t){const s=e.matched.length-1,i=t.matched.length-1;return s>-1&&s===i&&z(e.matched[s],t.matched[i])&&ht(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function z(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function ht(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!on(n[t],e[t]))return!1;return!0}function on(n,e){return H(n)?ke(n,e):H(e)?ke(e,n):n===e}function ke(n,e){return H(e)?n.length===e.length&&n.every((t,s)=>t===e[s]):n.length===1&&n[0]===e}function rn(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),s=n.split("/"),i=s[s.length-1];(i===".."||i===".")&&s.push("");let o=t.length-1,a,l;for(a=0;a<s.length;a++)if(l=s[a],l!==".")if(l==="..")o>1&&o--;else break;return t.slice(0,o).join("/")+"/"+s.slice(a).join("/")}const B={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var te;(function(n){n.pop="pop",n.push="push"})(te||(te={}));var Q;(function(n){n.back="back",n.forward="forward",n.unknown=""})(Q||(Q={}));function an(n){if(!n)if(X){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),tn(n)}const ln=/^[^#]+#/;function cn(n,e){return n.replace(ln,"#")+e}function hn(n,e){const t=document.documentElement.getBoundingClientRect(),s=n.getBoundingClientRect();return{behavior:e.behavior,left:s.left-t.left-(e.left||0),top:s.top-t.top-(e.top||0)}}const re=()=>({left:window.scrollX,top:window.scrollY});function un(n){let e;if("el"in n){const t=n.el,s=typeof t=="string"&&t.startsWith("#"),i=typeof t=="string"?s?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!i)return;e=hn(i,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function Ne(n,e){return(history.state?history.state.position-e:-1)+n}const ye=new Map;function dn(n,e){ye.set(n,e)}function fn(n){const e=ye.get(n);return ye.delete(n),e}let pn=()=>location.protocol+"//"+location.host;function ut(n,e){const{pathname:t,search:s,hash:i}=e,o=n.indexOf("#");if(o>-1){let l=i.includes(n.slice(o))?n.slice(o).length:1,r=i.slice(l);return r[0]!=="/"&&(r="/"+r),He(r,"")}return He(t,n)+s+i}function mn(n,e,t,s){let i=[],o=[],a=null;const l=({state:d})=>{const p=ut(n,location),R=t.value,y=e.value;let T=0;if(d){if(t.value=p,e.value=d,a&&a===R){a=null;return}T=y?d.position-y.position:0}else s(p);i.forEach(E=>{E(t.value,R,{delta:T,type:te.pop,direction:T?T>0?Q.forward:Q.back:Q.unknown})})};function r(){a=t.value}function h(d){i.push(d);const p=()=>{const R=i.indexOf(d);R>-1&&i.splice(R,1)};return o.push(p),p}function u(){const{history:d}=window;d.state&&d.replaceState(C({},d.state,{scroll:re()}),"")}function c(){for(const d of o)d();o=[],window.removeEventListener("popstate",l),window.removeEventListener("beforeunload",u)}return window.addEventListener("popstate",l),window.addEventListener("beforeunload",u,{passive:!0}),{pauseListeners:r,listen:h,destroy:c}}function Be(n,e,t,s=!1,i=!1){return{back:n,current:e,forward:t,replaced:s,position:window.history.length,scroll:i?re():null}}function vn(n){const{history:e,location:t}=window,s={value:ut(n,t)},i={value:e.state};i.value||o(s.value,{back:null,current:s.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function o(r,h,u){const c=n.indexOf("#"),d=c>-1?(t.host&&document.querySelector("base")?n:n.slice(c))+r:pn()+n+r;try{e[u?"replaceState":"pushState"](h,"",d),i.value=h}catch(p){console.error(p),t[u?"replace":"assign"](d)}}function a(r,h){const u=C({},e.state,Be(i.value.back,r,i.value.forward,!0),h,{position:i.value.position});o(r,u,!0),s.value=r}function l(r,h){const u=C({},i.value,e.state,{forward:r,scroll:re()});o(u.current,u,!0);const c=C({},Be(s.value,r,null),{position:u.position+1},h);o(r,c,!1),s.value=r}return{location:s,state:i,push:l,replace:a}}function gn(n){n=an(n);const e=vn(n),t=mn(n,e.state,e.location,e.replace);function s(o,a=!0){a||t.pauseListeners(),history.go(o)}const i=C({location:"",base:n,go:s,createHref:cn.bind(null,n)},e,t);return Object.defineProperty(i,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(i,"state",{enumerable:!0,get:()=>e.state.value}),i}function wn(n){return n=location.host?n||location.pathname+location.search:"",n.includes("#")||(n+="#"),gn(n)}function En(n){return typeof n=="string"||n&&typeof n=="object"}function dt(n){return typeof n=="string"||typeof n=="symbol"}const ft=Symbol("");var We;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(We||(We={}));function $(n,e){return C(new Error,{type:n,[ft]:!0},e)}function k(n,e){return n instanceof Error&&ft in n&&(e==null||!!(n.type&e))}const Fe="[^/]+?",Rn={sensitive:!1,strict:!1,start:!0,end:!0},yn=/[.+*?^${}()[\]/\\]/g;function Tn(n,e){const t=C({},Rn,e),s=[];let i=t.start?"^":"";const o=[];for(const h of n){const u=h.length?[]:[90];t.strict&&!h.length&&(i+="/");for(let c=0;c<h.length;c++){const d=h[c];let p=40+(t.sensitive?.25:0);if(d.type===0)c||(i+="/"),i+=d.value.replace(yn,"\\$&"),p+=40;else if(d.type===1){const{value:R,repeatable:y,optional:T,regexp:E}=d;o.push({name:R,repeatable:y,optional:T});const g=E||Fe;if(g!==Fe){p+=10;try{new RegExp(`(${g})`)}catch(L){throw new Error(`Invalid custom RegExp for param "${R}" (${g}): `+L.message)}}let x=y?`((?:${g})(?:/(?:${g}))*)`:`(${g})`;c||(x=T&&h.length<2?`(?:/${x})`:"/"+x),T&&(x+="?"),i+=x,p+=20,T&&(p+=-8),y&&(p+=-20),g===".*"&&(p+=-50)}u.push(p)}s.push(u)}if(t.strict&&t.end){const h=s.length-1;s[h][s[h].length-1]+=.7000000000000001}t.strict||(i+="/?"),t.end?i+="$":t.strict&&!i.endsWith("/")&&(i+="(?:/|$)");const a=new RegExp(i,t.sensitive?"":"i");function l(h){const u=h.match(a),c={};if(!u)return null;for(let d=1;d<u.length;d++){const p=u[d]||"",R=o[d-1];c[R.name]=p&&R.repeatable?p.split("/"):p}return c}function r(h){let u="",c=!1;for(const d of n){(!c||!u.endsWith("/"))&&(u+="/"),c=!1;for(const p of d)if(p.type===0)u+=p.value;else if(p.type===1){const{value:R,repeatable:y,optional:T}=p,E=R in h?h[R]:"";if(H(E)&&!y)throw new Error(`Provided param "${R}" is an array but it is not repeatable (* or + modifiers)`);const g=H(E)?E.join("/"):E;if(!g)if(T)d.length<2&&(u.endsWith("/")?u=u.slice(0,-1):c=!0);else throw new Error(`Missing required param "${R}"`);u+=g}}return u||"/"}return{re:a,score:s,keys:o,parse:l,stringify:r}}function On(n,e){let t=0;for(;t<n.length&&t<e.length;){const s=e[t]-n[t];if(s)return s;t++}return n.length<e.length?n.length===1&&n[0]===80?-1:1:n.length>e.length?e.length===1&&e[0]===80?1:-1:0}function pt(n,e){let t=0;const s=n.score,i=e.score;for(;t<s.length&&t<i.length;){const o=On(s[t],i[t]);if(o)return o;t++}if(Math.abs(i.length-s.length)===1){if(Ge(s))return 1;if(Ge(i))return-1}return i.length-s.length}function Ge(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const _n={type:0,value:""},xn=/[a-zA-Z0-9_]/;function Cn(n){if(!n)return[[]];if(n==="/")return[[_n]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(p){throw new Error(`ERR (${t})/"${h}": ${p}`)}let t=0,s=t;const i=[];let o;function a(){o&&i.push(o),o=[]}let l=0,r,h="",u="";function c(){h&&(t===0?o.push({type:0,value:h}):t===1||t===2||t===3?(o.length>1&&(r==="*"||r==="+")&&e(`A repeatable param (${h}) must be alone in its segment. eg: '/:ids+.`),o.push({type:1,value:h,regexp:u,repeatable:r==="*"||r==="+",optional:r==="*"||r==="?"})):e("Invalid state to consume buffer"),h="")}function d(){h+=r}for(;l<n.length;){if(r=n[l++],r==="\\"&&t!==2){s=t,t=4;continue}switch(t){case 0:r==="/"?(h&&c(),a()):r===":"?(c(),t=1):d();break;case 4:d(),t=s;break;case 1:r==="("?t=2:xn.test(r)?d():(c(),t=0,r!=="*"&&r!=="?"&&r!=="+"&&l--);break;case 2:r===")"?u[u.length-1]=="\\"?u=u.slice(0,-1)+r:t=3:u+=r;break;case 3:c(),t=0,r!=="*"&&r!=="?"&&r!=="+"&&l--,u="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${h}"`),c(),a(),i}function Sn(n,e,t){const s=Tn(Cn(n.path),t),i=C(s,{record:n,parent:e,children:[],alias:[]});return e&&!i.record.aliasOf==!e.record.aliasOf&&e.children.push(i),i}function Pn(n,e){const t=[],s=new Map;e=$e({strict:!1,end:!0,sensitive:!1},e);function i(c){return s.get(c)}function o(c,d,p){const R=!p,y=Xe(c);y.aliasOf=p&&p.record;const T=$e(e,c),E=[y];if("alias"in c){const L=typeof c.alias=="string"?[c.alias]:c.alias;for(const F of L)E.push(Xe(C({},y,{components:p?p.record.components:y.components,path:F,aliasOf:p?p.record:y})))}let g,x;for(const L of E){const{path:F}=L;if(d&&F[0]!=="/"){const N=d.record.path,I=N[N.length-1]==="/"?"":"/";L.path=d.record.path+(F&&I+F)}if(g=Sn(L,d,T),p?p.alias.push(g):(x=x||g,x!==g&&x.alias.push(g),R&&c.name&&!ze(g)&&a(c.name)),mt(g)&&r(g),y.children){const N=y.children;for(let I=0;I<N.length;I++)o(N[I],g,p&&p.children[I])}p=p||g}return x?()=>{a(x)}:Z}function a(c){if(dt(c)){const d=s.get(c);d&&(s.delete(c),t.splice(t.indexOf(d),1),d.children.forEach(a),d.alias.forEach(a))}else{const d=t.indexOf(c);d>-1&&(t.splice(d,1),c.record.name&&s.delete(c.record.name),c.children.forEach(a),c.alias.forEach(a))}}function l(){return t}function r(c){const d=bn(c,t);t.splice(d,0,c),c.record.name&&!ze(c)&&s.set(c.record.name,c)}function h(c,d){let p,R={},y,T;if("name"in c&&c.name){if(p=s.get(c.name),!p)throw $(1,{location:c});T=p.record.name,R=C(Ye(d.params,p.keys.filter(x=>!x.optional).concat(p.parent?p.parent.keys.filter(x=>x.optional):[]).map(x=>x.name)),c.params&&Ye(c.params,p.keys.map(x=>x.name))),y=p.stringify(R)}else if(c.path!=null)y=c.path,p=t.find(x=>x.re.test(y)),p&&(R=p.parse(y),T=p.record.name);else{if(p=d.name?s.get(d.name):t.find(x=>x.re.test(d.path)),!p)throw $(1,{location:c,currentLocation:d});T=p.record.name,R=C({},d.params,c.params),y=p.stringify(R)}const E=[];let g=p;for(;g;)E.unshift(g.record),g=g.parent;return{name:T,path:y,params:R,matched:E,meta:Ln(E)}}n.forEach(c=>o(c));function u(){t.length=0,s.clear()}return{addRoute:o,resolve:h,removeRoute:a,clearRoutes:u,getRoutes:l,getRecordMatcher:i}}function Ye(n,e){const t={};for(const s of e)s in n&&(t[s]=n[s]);return t}function Xe(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:An(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function An(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const s in n.components)e[s]=typeof t=="object"?t[s]:t;return e}function ze(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function Ln(n){return n.reduce((e,t)=>C(e,t.meta),{})}function $e(n,e){const t={};for(const s in n)t[s]=s in e?e[s]:n[s];return t}function bn(n,e){let t=0,s=e.length;for(;t!==s;){const o=t+s>>1;pt(n,e[o])<0?s=o:t=o+1}const i=Mn(n);return i&&(s=e.lastIndexOf(i,s-1)),s}function Mn(n){let e=n;for(;e=e.parent;)if(mt(e)&&pt(n,e)===0)return e}function mt({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function Dn(n){const e={};if(n===""||n==="?")return e;const s=(n[0]==="?"?n.slice(1):n).split("&");for(let i=0;i<s.length;++i){const o=s[i].replace(rt," "),a=o.indexOf("="),l=ee(a<0?o:o.slice(0,a)),r=a<0?null:ee(o.slice(a+1));if(l in e){let h=e[l];H(h)||(h=e[l]=[h]),h.push(r)}else e[l]=r}return e}function Ve(n){let e="";for(let t in n){const s=n[t];if(t=Zt(t),s==null){s!==void 0&&(e+=(e.length?"&":"")+t);continue}(H(s)?s.map(o=>o&&Re(o)):[s&&Re(s)]).forEach(o=>{o!==void 0&&(e+=(e.length?"&":"")+t,o!=null&&(e+="="+o))})}return e}function In(n){const e={};for(const t in n){const s=n[t];s!==void 0&&(e[t]=H(s)?s.map(i=>i==null?null:""+i):s==null?s:""+s)}return e}const Hn=Symbol(""),Ue=Symbol(""),_e=Symbol(""),vt=Symbol(""),Te=Symbol("");function q(){let n=[];function e(s){return n.push(s),()=>{const i=n.indexOf(s);i>-1&&n.splice(i,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function W(n,e,t,s,i,o=a=>a()){const a=s&&(s.enterCallbacks[i]=s.enterCallbacks[i]||[]);return()=>new Promise((l,r)=>{const h=d=>{d===!1?r($(4,{from:t,to:e})):d instanceof Error?r(d):En(d)?r($(2,{from:e,to:d})):(a&&s.enterCallbacks[i]===a&&typeof d=="function"&&a.push(d),l())},u=o(()=>n.call(s&&s.instances[i],e,t,h));let c=Promise.resolve(u);n.length<3&&(c=c.then(h)),c.catch(d=>r(d))})}function ve(n,e,t,s,i=o=>o()){const o=[];for(const a of n)for(const l in a.components){let r=a.components[l];if(!(e!=="beforeRouteEnter"&&!a.instances[l]))if(it(r)){const u=(r.__vccOpts||r)[e];u&&o.push(W(u,t,s,a,l,i))}else{let h=r();o.push(()=>h.then(u=>{if(!u)throw new Error(`Couldn't resolve component "${l}" at "${a.path}"`);const c=Ft(u)?u.default:u;a.mods[l]=u,a.components[l]=c;const p=(c.__vccOpts||c)[e];return p&&W(p,t,s,a,l,i)()}))}}return o}function je(n){const e=J(_e),t=J(vt),s=D(()=>{const r=K(n.to);return e.resolve(r)}),i=D(()=>{const{matched:r}=s.value,{length:h}=r,u=r[h-1],c=t.matched;if(!u||!c.length)return-1;const d=c.findIndex(z.bind(null,u));if(d>-1)return d;const p=qe(r[h-2]);return h>1&&qe(u)===p&&c[c.length-1].path!==p?c.findIndex(z.bind(null,r[h-2])):d}),o=D(()=>i.value>-1&&Fn(t.params,s.value.params)),a=D(()=>i.value>-1&&i.value===t.matched.length-1&&ht(t.params,s.value.params));function l(r={}){if(Wn(r)){const h=e[K(n.replace)?"replace":"push"](K(n.to)).catch(Z);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>h),h}return Promise.resolve()}return{route:s,href:D(()=>s.value.href),isActive:o,isExactActive:a,navigate:l}}function kn(n){return n.length===1?n[0]:n}const Nn=tt({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:je,setup(n,{slots:e}){const t=Ot(je(n)),{options:s}=J(_e),i=D(()=>({[Ke(n.activeClass,s.linkActiveClass,"router-link-active")]:t.isActive,[Ke(n.exactActiveClass,s.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const o=e.default&&kn(e.default(t));return n.custom?o:nt("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:i.value},o)}}}),Bn=Nn;function Wn(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function Fn(n,e){for(const t in e){const s=e[t],i=n[t];if(typeof s=="string"){if(s!==i)return!1}else if(!H(i)||i.length!==s.length||s.some((o,a)=>o!==i[a]))return!1}return!0}function qe(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const Ke=(n,e,t)=>n??e??t,Gn=tt({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const s=J(Te),i=D(()=>n.route||s.value),o=J(Ue,0),a=D(()=>{let h=K(o);const{matched:u}=i.value;let c;for(;(c=u[h])&&!c.components;)h++;return h}),l=D(()=>i.value.matched[a.value]);fe(Ue,D(()=>a.value+1)),fe(Hn,l),fe(Te,i);const r=Y();return Tt(()=>[r.value,l.value,n.name],([h,u,c],[d,p,R])=>{u&&(u.instances[c]=h,p&&p!==u&&h&&h===d&&(u.leaveGuards.size||(u.leaveGuards=p.leaveGuards),u.updateGuards.size||(u.updateGuards=p.updateGuards))),h&&u&&(!p||!z(u,p)||!d)&&(u.enterCallbacks[c]||[]).forEach(y=>y(h))},{flush:"post"}),()=>{const h=i.value,u=n.name,c=l.value,d=c&&c.components[u];if(!d)return Ze(t.default,{Component:d,route:h});const p=c.props[u],R=p?p===!0?h.params:typeof p=="function"?p(h):p:null,T=nt(d,C({},R,e,{onVnodeUnmounted:E=>{E.component.isUnmounted&&(c.instances[u]=null)},ref:r}));return Ze(t.default,{Component:T,route:h})||T}}});function Ze(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const Yn=Gn;function Xn(n){const e=Pn(n.routes,n),t=n.parseQuery||Dn,s=n.stringifyQuery||Ve,i=n.history,o=q(),a=q(),l=q(),r=Rt(B);let h=B;X&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const u=pe.bind(null,f=>""+f),c=pe.bind(null,Jt),d=pe.bind(null,ee);function p(f,v){let m,w;return dt(f)?(m=e.getRecordMatcher(f),w=v):w=f,e.addRoute(w,m)}function R(f){const v=e.getRecordMatcher(f);v&&e.removeRoute(v)}function y(){return e.getRoutes().map(f=>f.record)}function T(f){return!!e.getRecordMatcher(f)}function E(f,v){if(v=C({},v||r.value),typeof f=="string"){const O=me(t,f,v.path),A=e.resolve({path:O.path},v),U=i.createHref(O.fullPath);return C(O,A,{params:d(A.params),hash:ee(O.hash),redirectedFrom:void 0,href:U})}let m;if(f.path!=null)m=C({},f,{path:me(t,f.path,v.path).path});else{const O=C({},f.params);for(const A in O)O[A]==null&&delete O[A];m=C({},f,{params:c(O)}),v.params=c(v.params)}const w=e.resolve(m,v),S=f.hash||"";w.params=u(d(w.params));const P=nn(s,C({},f,{hash:Kt(S),path:w.path})),_=i.createHref(P);return C({fullPath:P,hash:S,query:s===Ve?In(f.query):f.query||{}},w,{redirectedFrom:void 0,href:_})}function g(f){return typeof f=="string"?me(t,f,r.value.path):C({},f)}function x(f,v){if(h!==f)return $(8,{from:v,to:f})}function L(f){return I(f)}function F(f){return L(C(g(f),{replace:!0}))}function N(f){const v=f.matched[f.matched.length-1];if(v&&v.redirect){const{redirect:m}=v;let w=typeof m=="function"?m(f):m;return typeof w=="string"&&(w=w.includes("?")||w.includes("#")?w=g(w):{path:w},w.params={}),C({query:f.query,hash:f.hash,params:w.path!=null?{}:f.params},w)}}function I(f,v){const m=h=E(f),w=r.value,S=f.state,P=f.force,_=f.replace===!0,O=N(m);if(O)return I(C(g(O),{state:typeof O=="object"?C({},S,O.state):S,force:P,replace:_}),v||m);const A=m;A.redirectedFrom=v;let U;return!P&&sn(s,w,m)&&(U=$(16,{to:A,from:w}),Ae(w,w,!0,!1)),(U?Promise.resolve(U):xe(A,w)).catch(M=>k(M)?k(M,2)?M:he(M):ce(M,A,w)).then(M=>{if(M){if(k(M,2))return I(C({replace:_},g(M.to),{state:typeof M.to=="object"?C({},S,M.to.state):S,force:P}),v||A)}else M=Se(A,w,!0,_,S);return Ce(A,w,M),M})}function gt(f,v){const m=x(f,v);return m?Promise.reject(m):Promise.resolve()}function ae(f){const v=se.values().next().value;return v&&typeof v.runWithContext=="function"?v.runWithContext(f):f()}function xe(f,v){let m;const[w,S,P]=zn(f,v);m=ve(w.reverse(),"beforeRouteLeave",f,v);for(const O of w)O.leaveGuards.forEach(A=>{m.push(W(A,f,v))});const _=gt.bind(null,f,v);return m.push(_),G(m).then(()=>{m=[];for(const O of o.list())m.push(W(O,f,v));return m.push(_),G(m)}).then(()=>{m=ve(S,"beforeRouteUpdate",f,v);for(const O of S)O.updateGuards.forEach(A=>{m.push(W(A,f,v))});return m.push(_),G(m)}).then(()=>{m=[];for(const O of P)if(O.beforeEnter)if(H(O.beforeEnter))for(const A of O.beforeEnter)m.push(W(A,f,v));else m.push(W(O.beforeEnter,f,v));return m.push(_),G(m)}).then(()=>(f.matched.forEach(O=>O.enterCallbacks={}),m=ve(P,"beforeRouteEnter",f,v,ae),m.push(_),G(m))).then(()=>{m=[];for(const O of a.list())m.push(W(O,f,v));return m.push(_),G(m)}).catch(O=>k(O,8)?O:Promise.reject(O))}function Ce(f,v,m){l.list().forEach(w=>ae(()=>w(f,v,m)))}function Se(f,v,m,w,S){const P=x(f,v);if(P)return P;const _=v===B,O=X?history.state:{};m&&(w||_?i.replace(f.fullPath,C({scroll:_&&O&&O.scroll},S)):i.push(f.fullPath,S)),r.value=f,Ae(f,v,m,_),he()}let V;function wt(){V||(V=i.listen((f,v,m)=>{if(!Le.listening)return;const w=E(f),S=N(w);if(S){I(C(S,{replace:!0,force:!0}),w).catch(Z);return}h=w;const P=r.value;X&&dn(Ne(P.fullPath,m.delta),re()),xe(w,P).catch(_=>k(_,12)?_:k(_,2)?(I(C(g(_.to),{force:!0}),w).then(O=>{k(O,20)&&!m.delta&&m.type===te.pop&&i.go(-1,!1)}).catch(Z),Promise.reject()):(m.delta&&i.go(-m.delta,!1),ce(_,w,P))).then(_=>{_=_||Se(w,P,!1),_&&(m.delta&&!k(_,8)?i.go(-m.delta,!1):m.type===te.pop&&k(_,20)&&i.go(-1,!1)),Ce(w,P,_)}).catch(Z)}))}let le=q(),Pe=q(),ne;function ce(f,v,m){he(f);const w=Pe.list();return w.length?w.forEach(S=>S(f,v,m)):console.error(f),Promise.reject(f)}function Et(){return ne&&r.value!==B?Promise.resolve():new Promise((f,v)=>{le.add([f,v])})}function he(f){return ne||(ne=!f,wt(),le.list().forEach(([v,m])=>f?m(f):v()),le.reset()),f}function Ae(f,v,m,w){const{scrollBehavior:S}=n;if(!X||!S)return Promise.resolve();const P=!m&&fn(Ne(f.fullPath,0))||(w||!m)&&history.state&&history.state.scroll||null;return st().then(()=>S(f,v,P)).then(_=>_&&un(_)).catch(_=>ce(_,f,v))}const ue=f=>i.go(f);let de;const se=new Set,Le={currentRoute:r,listening:!0,addRoute:p,removeRoute:R,clearRoutes:e.clearRoutes,hasRoute:T,getRoutes:y,resolve:E,options:n,push:L,replace:F,go:ue,back:()=>ue(-1),forward:()=>ue(1),beforeEach:o.add,beforeResolve:a.add,afterEach:l.add,onError:Pe.add,isReady:Et,install(f){const v=this;f.component("RouterLink",Bn),f.component("RouterView",Yn),f.config.globalProperties.$router=v,Object.defineProperty(f.config.globalProperties,"$route",{enumerable:!0,get:()=>K(r)}),X&&!de&&r.value===B&&(de=!0,L(i.location).catch(S=>{}));const m={};for(const S in B)Object.defineProperty(m,S,{get:()=>r.value[S],enumerable:!0});f.provide(_e,v),f.provide(vt,yt(m)),f.provide(Te,r);const w=f.unmount;se.add(f),f.unmount=function(){se.delete(f),se.size<1&&(h=B,V&&V(),V=null,r.value=B,de=!1,ne=!1),w()}}};function G(f){return f.reduce((v,m)=>v.then(()=>ae(m)),Promise.resolve())}return Le}function zn(n,e){const t=[],s=[],i=[],o=Math.max(e.matched.length,n.matched.length);for(let a=0;a<o;a++){const l=e.matched[a];l&&(n.matched.find(h=>z(h,l))?s.push(l):t.push(l));const r=n.matched[a];r&&(e.matched.find(h=>z(h,r))||i.push(r))}return[t,s,i]}function $n(){var n=new Ee(4);return Ee!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function Qe(n,e,t,s){var i=new Ee(4);return i[0]=n,i[1]=e,i[2]=t,i[3]=s,i}function Je(n,e,t){var s=e[0],i=e[1],o=e[2],a=e[3];return n[0]=t[0]*s+t[4]*i+t[8]*o+t[12]*a,n[1]=t[1]*s+t[5]*i+t[9]*o+t[13]*a,n[2]=t[2]*s+t[6]*i+t[10]*o+t[14]*a,n[3]=t[3]*s+t[7]*i+t[11]*o+t[15]*a,n}(function(){var n=$n();return function(e,t,s,i,o,a){var l,r;for(t||(t=4),s||(s=0),i?r=Math.min(i*t+s,e.length):r=e.length,l=s;l<r;l+=t)n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],n[3]=e[l+3],o(n,n,a),e[l]=n[0],e[l+1]=n[1],e[l+2]=n[2],e[l+3]=n[3];return e}})();class Vn{static operatorColors=new Map;static colorPalette=[[.121,.466,.705,1],[.89,.101,.109,1],[.215,.61,.341,1],[.596,.305,.639,1],[1,.498,0,1],[.55,.341,.29,1],[.965,.592,.117,1],[.5,.5,.5,1],[.8,.47,.737,1],[.58,.403,.741,1],[.8,.725,.454,1],[.172,.627,.172,1],[.839,.152,.156,1],[.549,.337,.294,1],[.89,.466,.76,1],[.498,.498,.498,1],[.737,.741,.133,1],[.09,.745,.811,1],[.8,.8,.8,1],[0,0,0,1]];static getColorForOperator(e){if(!this.operatorColors.has(e)){const t=this.operatorColors.size%this.colorPalette.length;this.operatorColors.set(e,this.colorPalette[t])}return this.operatorColors.get(e)}static getBaseColorForOperationType(e){return{compute:[.95,.95,.95,.3],load:[.95,.98,.95,.3],store:[.98,.95,.95,.3]}[e]||[.9,.9,.9,.3]}static getHighlightBorderColor(e){return(e[0]*299+e[1]*587+e[2]*114)/1e3>.5?[0,0,0,1]:[1,1,1,1]}static getGlowColor(e){return[(e[0]+.5)%1,(e[1]+.3)%1,(e[2]+.7)%1,.6]}static getHighlightColor(e,t="border"){switch(t){case"border":return this.getHighlightBorderColor(e);case"glow":return this.getGlowColor(e);case"invert":return this.getInvertedColor(e);case"saturate":return this.getSaturatedColor(e);default:return this.getDefaultHighlight(e)}}static getInvertedColor(e){return[1-e[0],1-e[1],1-e[2],1]}static getSaturatedColor(e){const[t,s,i,o]=e,a=Math.max(t,s,i),l=Math.min(t,s,i),r=a-l;if(r===0)return e;const u=(1-1.5)*r;return[Math.min(1,t+(t-l)*u/r),Math.min(1,s+(s-l)*u/r),Math.min(1,i+(i-l)*u/r),o]}static getDefaultHighlight(e){const[t,s,i]=this.rgbToHsl(e[0],e[1],e[2]),o=Math.min(.9,i+.3),a=this.hslToRgb(t,s,o);return[a[0],a[1],a[2],e[3]]}static rgbToHsl(e,t,s){e/=255,t/=255,s/=255;const i=Math.max(e,t,s),o=Math.min(e,t,s);let a,l,r=(i+o)/2;if(i===o)a=l=0;else{const h=i-o;switch(l=r>.5?h/(2-i-o):h/(i+o),i){case e:a=(t-s)/h+(t<s?6:0);break;case t:a=(s-e)/h+2;break;case s:a=(e-t)/h+4;break}a/=6}return[a,l,r]}static hslToRgb(e,t,s){let i,o,a;if(t===0)i=o=a=s;else{const l=(u,c,d)=>(d<0&&(d+=1),d>1&&(d-=1),d<.16666666666666666?u+(c-u)*6*d:d<.5?c:d<.6666666666666666?u+(c-u)*(.6666666666666666-d)*6:u),r=s<.5?s*(1+t):s+t-s*t,h=2*s-r;i=l(h,r,e+1/3),o=l(h,r,e),a=l(h,r,e-1/3)}return[Math.round(i*255),Math.round(o*255),Math.round(a*255)]}static getSelectedColor(e){return[Math.max(e[0]-.1,0),Math.max(e[1]-.1,0),Math.max(e[2]-.1,0),e[3]+.2]}static resetColorMap(){this.operatorColors.clear()}static rgbaToCss(e){return`rgba(${Math.round(e[0]*255)}, ${Math.round(e[1]*255)}, ${Math.round(e[2]*255)}, ${e[3]})`}static getBorderColorForType(e){return{compute:[.7,.7,.7,.8],load:[.5,.8,.5,.8],store:[.8,.5,.5,.8]}[e]||[.6,.6,.6,.8]}}class Un{constructor({canvas:e,tooltipElement:t,onOperationSelect:s=()=>{},onOperationHover:i=()=>{}}){this.canvas=e,this.gl=e.getContext("webgl")||e.getContext("experimental-webgl"),this.tooltipElement=t,this.onOperationSelect=s,this.onOperationHover=i,this.program=null,this.overlayProgram=null,this.buffers={},this.uniforms={},this.overlayUniforms={},this.attributes={},this.overlayAttributes={},this.projectionMatrix=j(),this.viewMatrix=j(),this.viewProjectionMatrix=j(),this.orthoMatrix=j(),this.overlayCanvas=document.createElement("canvas"),this.overlayCtx=this.overlayCanvas.getContext("2d"),this.overlayTexture=null,this.data=null,this.zoomLevel=1,this.viewOffset=0,this.hoveredOperation=null,this.selectedOperations=new Set,this.dependencies={},this.animationFrame=null,this.lanes=[{id:"stores",label:"存储操作",color:[.882,.341,.349,1]},{id:"compute",label:"计算操作",color:[.305,.557,.655,1]},{id:"loads",label:"加载操作",color:[.949,.557,.173,1]}],this.fixedLeft=80,this.translateX=0,this.WORLD_COORDS={AXIS_Y:-3,TOP_Y:1.2,LANE_START_Y:-1.8,LANE_HEIGHT:.8,LABEL_OFFSET_X:-.5,TICK_LENGTH:.2},this.RECT_COORDS={LANE_START_Y:-1.8,LANE_HEIGHT:.8,RECT_HEIGHT_RATIO:.5,LANE_MARGIN:.2},this.timeStepBaseWidth=50,this.stepInterval=1,this.minZoom=1e-4,this.maxZoom=5,this.isDragging=!1,this.dragStartX=0,this.startViewOffset=0,this.dependencies={downstream:{},upstream:{}},this.gl?this.initWebGL():console.error("WebGL not supported"),this.bindEvents(),this.resize()}initWebGL(){const e=this.gl;this.gl.enable(this.gl.POLYGON_OFFSET_FILL),this.gl.polygonOffset(1,1),this.gl.disable(this.gl.SMOOTH),this.gl.disable(this.gl.DITHER);const t=`
      attribute vec2 aPosition;
      attribute vec4 aColor;
      uniform mat4 uViewProjectionMatrix;
      varying vec4 vColor;
      
      void main() {
        gl_Position = uViewProjectionMatrix * vec4(aPosition, 0.0, 1.0);
        vColor = aColor;
      }
    `,s=`
      precision mediump float;
      varying vec4 vColor;
      
      void main() {
        gl_FragColor = vColor ;
      }
    `;this.program=this.createProgram(t,s);const i=`
      attribute vec2 aPosition;
      attribute vec2 aTexCoord;
      varying vec2 vTexCoord;
      
      void main() {
        gl_Position = vec4(aPosition, 0.0, 1.0);
        vTexCoord = aTexCoord;
      }
    `,o=`
      precision mediump float;
      varying vec2 vTexCoord;
      uniform sampler2D uTexture;
      
      void main() {
        gl_FragColor = texture2D(uTexture, vTexCoord);
      }
    `;this.overlayProgram=this.createProgram(i,o),e.useProgram(this.program),this.uniforms.viewProjectionMatrix=e.getUniformLocation(this.program,"uViewProjectionMatrix"),this.attributes.position=e.getAttribLocation(this.program,"aPosition"),this.attributes.color=e.getAttribLocation(this.program,"aColor"),e.useProgram(this.overlayProgram),this.overlayUniforms.texture=e.getUniformLocation(this.overlayProgram,"uTexture"),this.overlayAttributes.position=e.getAttribLocation(this.overlayProgram,"aPosition"),this.overlayAttributes.texCoord=e.getAttribLocation(this.overlayProgram,"aTexCoord"),this.buffers.operations=e.createBuffer(),this.buffers.lanes=e.createBuffer(),this.buffers.overlay=e.createBuffer(),this.buffers.overlayTexCoords=e.createBuffer(),this.overlayTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.overlayTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)}createProgram(e,t){const s=this.gl,i=this.compileShader(s.VERTEX_SHADER,e),o=this.compileShader(s.FRAGMENT_SHADER,t),a=s.createProgram();if(s.attachShader(a,i),s.attachShader(a,o),s.linkProgram(a),!s.getProgramParameter(a,s.LINK_STATUS))throw new Error("Program linking error: "+s.getProgramInfoLog(a));return a}compileShader(e,t){const s=this.gl,i=s.createShader(e);if(s.shaderSource(i,t),s.compileShader(i),!s.getShaderParameter(i,s.COMPILE_STATUS))throw new Error("Shader compilation error: "+s.getShaderInfoLog(i));return i}resize(){const e=window.devicePixelRatio||1;this.canvas.width=this.canvas.clientWidth*e,this.canvas.height=this.canvas.clientHeight*e,this.overlayCanvas.width=this.canvas.width,this.overlayCanvas.height=this.canvas.height;const t=this.fixedLeft*e,s=this.canvas.width-t;if(this.gl.viewport(t,0,s,this.canvas.height),this.data){const i=(this.canvas.width-this.fixedLeft*e)/e,o=this.timeStepBaseWidth*this.zoomLevel,a=i/o,l=Math.max(0,this.data.length-a);this.viewOffset=Math.min(l,this.viewOffset)}this.render()}setData(e){console.log("setData called with",e),this.data=e,this.viewOffset=0,this.analyzeDependencies(),console.log("Dependencies-downstream raw:",JSON.parse(JSON.stringify(this.dependencies.downstream))),console.log("Dependencies-upstream   raw:",JSON.parse(JSON.stringify(this.dependencies.upstream))),this.render()}updateMatrices(){if(!this.data)return;const e=window.devicePixelRatio||1,t=2,s=(this.canvas.width-this.fixedLeft*e)/e,i=this.timeStepBaseWidth*this.zoomLevel,o=s/i,a=this.data.length+1;this.viewOffset=Math.max(-1,Math.min(a,this.viewOffset));const l=Math.max(-t,this.viewOffset-t),r=Math.min(this.data.length+t,this.viewOffset+o+t),h=this.WORLD_COORDS.AXIS_Y-.5,u=this.WORLD_COORDS.TOP_Y+.5;_t(this.projectionMatrix,l,r,h,u,-1,1),xt(this.viewMatrix);const c=(0-l)/(r-l)*2-1,p=(-1+this.fixedLeft/(s+this.fixedLeft)*2-c)*(r-l)/2;Ct(this.viewMatrix,this.viewMatrix,[p,0,0]),St(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix)}worldToScreen(e,t){const s=window.devicePixelRatio||1,i=Qe(e,t,0,1);Je(i,i,this.viewProjectionMatrix);const o=i[0]/i[3],a=i[1]/i[3],l=0,r=this.canvas.width-l,h=this.canvas.height,u=l+(o+1)*.5*r,c=(1-a)*.5*h;return[u*s,c*s]}screenToWorld(e,t){const s=window.devicePixelRatio||1,i=e/s,o=t/s,a=0,l=this.canvas.width-a,r=this.canvas.height,h=2*(i-a)/l-1,u=1-2*o/r,c=Qe(h,u,0,1),d=j();Pt(d,this.viewProjectionMatrix),Je(c,c,d);const p=c[0]/c[3],R=c[1]/c[3];return[p,R]}render(){!this.gl||!this.data||(this.animationFrame&&cancelAnimationFrame(this.animationFrame),this.animationFrame=requestAnimationFrame(()=>{this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clearColor(.98,.98,.98,1),this.gl.disable(this.gl.DEPTH_TEST),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.updateMatrices(),this.drawOperations(),this.drawOverlay(),console.log({zoomLevel:this.zoomLevel,viewOffset:this.viewOffset})}))}drawLanes(){const e=this.gl;e.useProgram(this.program),e.uniformMatrix4fv(this.uniforms.viewProjectionMatrix,!1,this.viewProjectionMatrix);const t=[],s=[];this.lanes.forEach((i,o)=>{const a=this.RECT_COORDS.LABEL_OFFSET_X,l=this.RECT_COORDS.LANE_START_Y+o*this.RECT_COORDS.LANE_HEIGHT+this.RECT_COORDS.LANE_HEIGHT*this.RECT_COORDS.RECT_HEIGHT_RATIO/2,r=this.worldToScreen(a,l)[1],h=this.RECT_COORDS.LANE_HEIGHT*this.RECT_COORDS.RECT_HEIGHT_RATIO,u=[-100,r,100,r,-100,r+h,-100,r+h,100,r,100,r+h];t.push(...u);const c=[...i.color];c[3]=.3;for(let d=0;d<6;d++)s.push(...c)}),this.drawGeometry(t,s,this.buffers.lanes)}drawOperations(){const e=this.gl;e.useProgram(this.program),e.uniformMatrix4fv(this.uniforms.viewProjectionMatrix,!1,this.viewProjectionMatrix);const t=[],s=[],{startTs:i,endTs:o}=this.getVisibleTimeStepRange();for(let a=i;a<=o;a++){const l=this.data[a];l&&["stores","loads","compute"].forEach(r=>{l[r]&&l[r].forEach(h=>{this.addOperationGeometry(t,s,h,r,a)})})}t.length>0&&(console.log("绘制操作矩形"),this.drawGeometry(t,s,this.buffers.operations))}addOperationGeometry(e,t,s,i,o){const a=this.lanes.findIndex(L=>L.id===i);if(a===-1)return;const l=this.RECT_COORDS.LANE_START_Y+a*this.RECT_COORDS.LANE_HEIGHT,r=this.RECT_COORDS.LANE_HEIGHT*this.RECT_COORDS.RECT_HEIGHT_RATIO,h=this.data[o],u=h[i]?h[i].length:1,c=h[i].indexOf(s),p=1/u,R=o+c*p,y=p,T=this.hoveredOperation&&this.hoveredOperation.op&&this.hoveredOperation.op.id===s.id,E=this.selectedOperations.has(s.id);let g=Vn.getColorForOperator(s.id);T?g=[1,0,0,.3]:E&&(g=[0,1,0,.6]);const x=[R,l,R+y,l,R,l+r,R,l+r,R+y,l,R+y,l+r];e.push(...x);for(let L=0;L<6;L++)t.push(...g)}drawGeometry(e,t,s){const i=this.gl;console.log("绘制几何体 - 顶点数:",e.length/2);const o=new Float32Array(e.length/2*6);for(let a=0;a<e.length/2;a++)o[a*6]=e[a*2],o[a*6+1]=e[a*2+1],o[a*6+2]=t[a*4],o[a*6+3]=t[a*4+1],o[a*6+4]=t[a*4+2],o[a*6+5]=t[a*4+3];i.bindBuffer(i.ARRAY_BUFFER,s),i.bufferData(i.ARRAY_BUFFER,o,i.DYNAMIC_DRAW),i.enableVertexAttribArray(this.attributes.position),i.enableVertexAttribArray(this.attributes.color),i.vertexAttribPointer(this.attributes.position,2,i.FLOAT,!1,24,0),i.vertexAttribPointer(this.attributes.color,4,i.FLOAT,!1,24,8),i.drawArrays(i.TRIANGLES,0,e.length/2)}drawFixedLeftPanel(){const e=this.overlayCtx,t=window.devicePixelRatio||1,s=0,i=this.fixedLeft*t,o=this.overlayCanvas.height;e.save(),e.beginPath(),e.rect(s,0,i,o),e.clip(),e.fillStyle="#f7f7f7",e.fillRect(s,0,i,o),e.textAlign="right",e.textBaseline="middle",e.font=`${16*t}px Arial`,e.fillStyle="#333",this.lanes.forEach((r,h)=>{const u=this.RECT_COORDS.LANE_START_Y+h*this.RECT_COORDS.LANE_HEIGHT+this.RECT_COORDS.LANE_HEIGHT*this.RECT_COORDS.RECT_HEIGHT_RATIO/2,c=this.worldToScreen(0,u)[1];e.fillText(r.id,i-10*t,c)}),e.textAlign="left",e.textBaseline="middle",e.font=`${14*t}px Arial`;const a=this.WORLD_COORDS.AXIS_Y-.3,l=this.worldToScreen(0,a)[1];e.fillText("TimeSteps",s+10*t,l),e.restore()}drawAlignmentLinesWithCanvas2D(){const e=this.overlayCtx,t=window.devicePixelRatio||1;if(!this.data||this.data.length===0)return;const{startTs:s,endTs:i}=this.getVisibleTimeStepRange(),o=this.WORLD_COORDS.TOP_Y,a=this.WORLD_COORDS.AXIS_Y;e.strokeStyle="#544f4fff",e.lineWidth=1*t,e.setLineDash([2*t,2*t]);for(let l=s;l<=i;l++){const[r,h]=this.worldToScreen(l,o),[u,c]=this.worldToScreen(l,a);e.beginPath(),e.moveTo(r,h),e.lineTo(u,c),e.stroke()}e.setLineDash([])}drawTimelineWithCanvas2D(){const e=this.overlayCtx,t=window.devicePixelRatio||1;if(!this.data||this.data.length===0)return;const{startTs:s,endTs:i}=this.getVisibleTimeStepRange(),o=this.WORLD_COORDS.AXIS_Y,[a,l]=this.worldToScreen(s,o),[r,h]=this.worldToScreen(i,o);e.beginPath(),e.moveTo(a,l),e.lineTo(r,h),e.strokeStyle="#120c0cff",e.lineWidth=1*t,e.stroke();const u=this.calculateStepInterval(i-s);e.font=`${12*t}px Arial`,e.fillStyle="#333",e.textAlign="center",e.textBaseline="top";for(let c=s;c<=i;c++){const[d,p]=this.worldToScreen(c,o),[R,y]=this.worldToScreen(c,o-.3),T=c%u===0;if(T||(c===s||c===i)){e.beginPath();const g=T?10*t:6*t;e.moveTo(d,p-g),e.lineTo(d,p),e.strokeStyle=T?"#444":"#888",e.lineWidth=T?1.5*t:1*t,e.stroke(),T&&e.fillText(`T${c}`,R,y+5*t)}}this.debugCoordinateSystems()}calculateStepInterval(e){if(e<=0)return 1;const t=80,i=(this.canvas.width-this.fixedLeft*window.devicePixelRatio)/e;let o=1;return i<t&&(o=Math.ceil(t/i)),o>20?o=20:o>10?o=10:o>5?o=5:o>2&&(o=2),o}drawOverlay(){const e=window.devicePixelRatio||1;this.overlayCtx.clearRect(0,0,this.overlayCanvas.width,this.overlayCanvas.height),this.drawFixedLeftPanel(),this.overlayCtx.save(),this.overlayCtx.beginPath(),this.overlayCtx.rect(this.fixedLeft*e,0,this.overlayCanvas.width-this.fixedLeft*e,this.overlayCanvas.height),this.overlayCtx.clip(),this.drawTimelineWithCanvas2D(),this.drawAlignmentLinesWithCanvas2D(),this.drawDependenciesWithCanvas2D(),this.overlayCtx.restore(),this.renderOverlayTexture()}analyzeDependencies(){this.dependencies={downstream:{},upstream:{}};for(let e=0;e<this.data.length;e++)["loads","compute","stores"].forEach(t=>{this.data[e][t]&&this.data[e][t].forEach(s=>{const i=this.findDownstreamDependencies(s,e);i.length&&(this.dependencies.downstream[s.id]=i,i.forEach(o=>{this.dependencies.upstream[o.op.id]||(this.dependencies.upstream[o.op.id]=[]),this.dependencies.upstream[o.op.id].push({type:t,ts:e,op:s})}))})})}findDownstreamDependencies(e,t){const s=[];for(let i=t+1;i<this.data.length;i++)["loads","compute","stores"].forEach(o=>{if(!this.data[i][o])return;const a=this.data[i][o].find(l=>l.id===e.id);a&&s.push({type:o,ts:i,op:a})});return s}drawDependenciesWithCanvas2D(){console.log("drawDependenciesWithCanvas2D: selectedOperations =",this.selectedOperations);const e=window.devicePixelRatio||1;this.selectedOperations.forEach(t=>{this.dependencies.downstream[t]&&this.dependencies.downstream[t].forEach(s=>{const i=this.findOperationById(t),o={op:s.op,type:s.type,ts:s.ts};this.drawDependencyArrow(i,o,e,"#ff6b6b",2)}),this.dependencies.upstream[t]&&this.dependencies.upstream[t].forEach(s=>{const i={op:s.op,type:s.type,ts:s.ts},o=this.findOperationById(t);this.drawDependencyArrow(i,o,e,"#4ecdc4",2)})})}drawDependencyArrow(e,t,s,i,o){const a=this._getOpCenter(e),l=this._getOpCenter(t);if(!a||!l)return;const r=this.overlayCtx;r.beginPath(),r.moveTo(a.x,a.y);const h=Math.abs(l.x-a.x)*.4;r.bezierCurveTo(a.x+h,a.y,l.x-h,l.y,l.x,l.y),r.strokeStyle=i,r.lineWidth=o*s,r.setLineDash([]),r.stroke();const u=Math.atan2(l.y-a.y,l.x-a.x);r.save(),r.translate(l.x,l.y),r.rotate(u),r.fillStyle=i,r.beginPath(),r.moveTo(0,0),r.lineTo(-8*s,-4*s),r.lineTo(-8*s,4*s),r.closePath(),r.fill(),r.restore()}_getOpCenter({op:e,type:t,ts:s}){const i=this.lanes.findIndex(p=>p.id===t);if(i===-1)return null;const o=this.data[s],a=o[t]?o[t].length:1,l=o[t]?o[t].indexOf(e):0,r=1/a,h=s+l*r+r,u=this.RECT_COORDS.LANE_START_Y+i*this.RECT_COORDS.LANE_HEIGHT+this.RECT_COORDS.LANE_HEIGHT*this.RECT_COORDS.RECT_HEIGHT_RATIO/2,[c,d]=this.worldToScreen(h,u);return{x:c,y:d}}drawLaneLabelsWithCanvas2D(){const e=this.overlayCtx,t=window.devicePixelRatio||1;this.lanes.forEach((s,i)=>{const o=this.RECT_COORDS.LANE_START_Y+i*this.RECT_COORDS.LANE_HEIGHT+this.RECT_COORDS.LANE_HEIGHT*this.RECT_COORDS.RECT_HEIGHT_RATIO/2,a=-1,[l,r]=this.worldToScreen(a,o);e.fillStyle="#333",e.font=`${16*t}px Arial`,e.textAlign="right",e.textBaseline="middle",e.fillText(s.id,l,r)})}renderOverlayTexture(){const e=this.gl;e.bindTexture(e.TEXTURE_2D,this.overlayTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.overlayCanvas),e.useProgram(this.overlayProgram),e.uniform1i(this.overlayUniforms.texture,0);const t=new Float32Array([-1,-1,0,1,1,-1,1,1,-1,1,0,0,-1,1,0,0,1,-1,1,1,1,1,1,0]);e.bindBuffer(e.ARRAY_BUFFER,this.buffers.overlay),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.vertexAttribPointer(this.overlayAttributes.position,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(this.overlayAttributes.texCoord,2,e.FLOAT,!1,16,8),e.drawArrays(e.TRIANGLES,0,6),e.enable(e.BLEND)}bindEvents(){this.canvas.addEventListener("wheel",this.handleWheel.bind(this)),this.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.canvas.addEventListener("mouseleave",this.handleMouseLeave.bind(this)),this.canvas.addEventListener("click",this.handleClick.bind(this)),window.addEventListener("resize",this.resize.bind(this))}handleWheel(e){e.preventDefault();const t=this.canvas.getBoundingClientRect(),s=e.clientX-t.left,i=this.screenToWorld(s,0)[0],o=e.deltaY>0?-.1:.1,a=this.zoomLevel;this.zoomLevel=Math.max(this.minZoom,Math.min(this.maxZoom,this.zoomLevel+o));const l=a/this.zoomLevel,r=i;this.viewOffset=this.viewOffset+(i-r)*l,this.render()}handleMouseMove(e){const{x:t,y:s}=this.getCanvasRelativePosition(e),i=window.devicePixelRatio||1,o=t*i,a=s*i;if(this.isDragging){const[r,h]=this.screenToWorld(t,s),u=this.dragStartWorldX-r,c=this.startViewOffset+u,{x0:d,x1:p}=this.getVisibleTimeStepRange();this.viewOffset=Math.max(0,c),this.render();return}const l=this.hoveredOperation;this.hoveredOperation=this.findOperationAt(o,a),this.updateTooltip(t,s),l!==this.hoveredOperation&&this.render(),this.hoveredOperation&&this.onOperationHover(this.hoveredOperation)}getCanvasRelativePosition(e){const t=this.canvas.getBoundingClientRect(),s=getComputedStyle(this.canvas),i=parseInt(s.borderLeftWidth)||0,o=parseInt(s.borderTopWidth)||0,a=window.scrollX||window.pageXOffset,l=window.scrollY||window.pageYOffset;return{x:e.clientX+a-t.left-i,y:e.clientY+l-t.top-o}}handleMouseDown(e){this.isDragging=!0,this.dragStartX=e.clientX,this.startViewOffset=this.viewOffset;const{x:t,y:s}=this.getCanvasRelativePosition(e),[i,o]=this.screenToWorld(t,s);this.dragStartWorldX=i,e.preventDefault()}handleMouseUp(){this.isDragging=!1}handleMouseLeave(){this.isDragging=!1,this.hoveredOperation=null,this.updateTooltip(),this.render()}handleClick(e){if(!this.data||!this.hoveredOperation)return;const t=this.hoveredOperation.op.id;this.selectedOperations.clear(),this.selectedOperations.add(t),this.dependencies.downstream[t]&&this.dependencies.downstream[t].forEach(s=>{this.selectedOperations.add(s.op.id)}),this.dependencies.upstream[t]&&this.dependencies.upstream[t].forEach(s=>{this.selectedOperations.add(s.op.id)}),console.log(`Clicked operation: ${t}`),console.log("Selected operations:",[...this.selectedOperations]),this.onOperationSelect(this.hoveredOperation,this.selectedOperations),this.render()}addPeerDependencies(e){const t=this.findOperationById(e);if(t){if(t.type==="compute"){const s=this.findOperationByProperties({type:"loads",address:t.address,ts:t.ts-1}),i=this.findOperationByProperties({type:"stores",address:t.address,ts:t.ts+1});s&&this.selectedOperations.add(s.id),i&&this.selectedOperations.add(i.id)}else if(t.type==="loads"||t.type==="stores"){const s=this.findOperationByProperties({type:"compute",address:t.address,ts:t.type==="loads"?t.ts+1:t.ts-1});s&&this.selectedOperations.add(s.id)}}}findOperationAt(e,t){if(!this.data)return null;const[s,i]=this.screenToWorld(e,t),{startTs:o,endTs:a}=this.getVisibleTimeStepRange(2);for(let l=o;l<=a;l++){const r=this.data[l];if(r)for(const h of["stores","compute","loads"]){if(!r[h]||!r[h].length)continue;const u=this.lanes.findIndex(E=>E.id===h);if(u===-1)continue;const c=this.RECT_COORDS.LANE_HEIGHT*this.RECT_COORDS.RECT_HEIGHT_RATIO,d=this.RECT_COORDS.LANE_START_Y+u*this.RECT_COORDS.LANE_HEIGHT+c,p=d+c,R=window.devicePixelRatio||1;if(i*R<d||i*R>p)continue;const y=r[h].length,T=1/y;for(let E=0;E<y;E++){const g=r[h][E],x=l+E*T,L=x+T;if(s>=x&&s<=L)return{op:g,type:h,ts:l}}}}return null}calculateStepInterval(e){this.canvas.width-100;const s=Math.ceil(80/(this.timeStepBaseWidth*this.zoomLevel));return s<1?1:s>10?10*Math.ceil(s/10):s}findOperationById(e){if(!this.data)return null;for(let t=0;t<this.data.length;t++){const s=this.data[t];for(const i of["stores","compute","loads"])if(s[i]){const o=s[i].find(a=>a.id===e);if(o)return{op:o,type:i,ts:t}}}return null}updateTooltip(e,t){if(this.tooltipElement)if(this.hoveredOperation){const s=this.hoveredOperation.op,i=this.hoveredOperation.type;this.tooltipElement.innerHTML=`
        <div class="tooltip-title">Op</div>
        <div><span>ID:</span> ${s.id}</div>
        <div><span>Operation:</span> ${s.operation||"N/A"}</div>
        <div><span>Type:</span> ${i}</div>
        <div><span>TS:</span> ${this.hoveredOperation.ts}</div>
        <div><span>Duration:</span> ${Math.max(1,s.hold_in_lmem||0)} time steps</div>
        <div><span>Target:</span> ${s.target||"N/A"}</div>
      `,this.tooltipElement.style.left=`${e+15}px`,this.tooltipElement.style.top=`${t+15}px`,this.tooltipElement.classList.add("show")}else this.tooltipElement.classList.remove("show")}lightenColor(e,t){return[Math.min(1,e[0]+t),Math.min(1,e[1]+t),Math.min(1,e[2]+t),e[3]]}zoomIn(){this.zoomLevel=Math.min(this.maxZoom,this.zoomLevel+.2),this.render()}zoomOut(){this.zoomLevel=Math.max(this.minZoom,this.zoomLevel-.2),this.render()}resetZoom(){this.zoomLevel=1,this.viewOffset=0,this.render()}destroy(){this.animationFrame&&cancelAnimationFrame(this.animationFrame),this.gl&&(this.gl.deleteProgram(this.program),this.gl.deleteProgram(this.overlayProgram),Object.values(this.buffers).forEach(e=>this.gl.deleteBuffer(e)),this.gl.deleteTexture(this.overlayTexture)),this.canvas.removeEventListener("wheel",this.handleWheel),this.canvas.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("mousedown",this.handleMouseDown),this.canvas.removeEventListener("mouseup",this.handleMouseUp),this.canvas.removeEventListener("mouseleave",this.handleMouseLeave),this.canvas.removeEventListener("click",this.handleClick),window.removeEventListener("resize",this.resize)}logPoint(e,t,s){const[i,o]=this.worldToPhysical(t,s);console.log(`${e} | world(${t}, ${s}) -> phys(${i.toFixed(1)}, ${o.toFixed(1)})`)}worldToPhysical(e,t){const[s,i]=this.worldToScreen(e,t);return[s,i]}getVisibleTimeStepRange(e=1){const t=window.devicePixelRatio||1,s=this.fixedLeft;if(!this.data)return{startTs:0,endTs:0};const i=(this.canvas.width-s*t)/(this.timeStepBaseWidth*this.zoomLevel*t),o=Math.max(0,Math.floor(this.viewOffset-e)),a=Math.min(this.data.length-1,Math.ceil(this.viewOffset+i+e));return{startTs:o,endTs:a}}debugCoordinateSystems(){console.log("坐标系调试:"),console.log("- Y轴屏幕位置:",this.fixedLeft),console.log("- 时间步0世界坐标: (0, 0)"),console.log("- 时间步0屏幕坐标:",this.worldToScreen(0,0)),console.log("- 视图偏移 viewOffset:",this.viewOffset),console.log("- 画布宽度:",this.canvas.width)}}const jn={class:"timestep-view"},qn={class:"toolbar"},Kn={class:"visualization-area"},Zn={key:0,class:"stats-panel"},Qn={__name:"timestep-view",setup(n){const e=Y(null),t=Y(null),s=Y(null),i=Y(null),o=Y(null),a=D(()=>i.value?.length||0),l=D(()=>i.value?.reduce((E,g)=>E+(g.compute?.length||0),0)||0),r=D(()=>i.value?.reduce((E,g)=>E+(g.loads?.length||0),0)||0),h=D(()=>i.value?.reduce((E,g)=>E+(g.stores?.length||0),0)||0);At(async()=>{await st(),o.value=new Un({canvas:e.value,tooltipElement:t.value,onOperationSelect:c,onOperationHover:d}),window.addEventListener("resize",T),T()}),Lt(()=>{o.value?.destroy(),window.removeEventListener("resize",T)});function u(E){let g=E;if(E&&E.timestep&&(g=E.timestep),!g?.length){console.warn("[TimestepView] No valid timestep data received");return}i.value=g,o.value.setData(g),o.value.render()}function c(E,g){console.log("Operation selected:",E,g)}function d(E){}function p(){o.value?.zoomIn()}function R(){o.value?.zoomOut()}function y(){o.value?.resetZoom()}function T(){if(!s.value)return;const{width:E,height:g}=s.value.getBoundingClientRect();e.value.width=E,e.value.height=g,o.value?.render()}return(E,g)=>(we(),ge("div",jn,[b("div",qn,[oe(Mt,{onFileLoaded:u}),b("div",{class:"zoom-controls"},[b("button",{onClick:p},"+"),b("button",{onClick:R},"-"),b("button",{onClick:y},"Reset")])]),b("div",Kn,[b("div",{class:"main",ref_key:"main",ref:s},[b("canvas",{ref_key:"canvas",ref:e,class:"timestep-canvas"},null,512),b("div",{ref_key:"tooltip",ref:t,class:"tooltip"},null,512)],512)]),i.value?(we(),ge("div",Zn,[g[0]||(g[0]=b("h3",null,"时间步统计",-1)),b("p",null,"总时间步: "+ie(a.value),1),b("p",null,"compute操作: "+ie(l.value),1),b("p",null,"load操作: "+ie(r.value),1),b("p",null,"store操作: "+ie(h.value),1)])):bt("",!0)]))}},Jn=et(Qn,[["__scopeId","data-v-0dfb2cb6"]]),es=[{path:"/",redirect:"/lmem"},{path:"/lmem",name:"lmem",component:Dt},{path:"/timestep",name:"timestep",component:Jn}],ts=Xn({history:wn(),routes:es});console.log(">>> main.js 正在执行");It(Wt).use(ts).mount("#app");
