import{_ as et,r as be,c as ge,o as Ee,a as b,b as oe,w as De,d as Ie,n as Me,s as Rt,e as tt,u as K,f as yt,g as I,p as fe,h as G,i as Ot,j as nt,k as st,l as Tt,m as J,A as we,q as j,t as _t,v as St,x as Ct,y as xt,z as At,C as Pt,B as Lt,D as bt,E as Dt,F as It,G as ie,L as Mt,H as kt}from"./lmem-DIjmvvZA.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();const Ht={id:"app"},Nt={class:"view-navigation"},Wt={class:"main-content"},Bt={__name:"App",setup(n){return(e,t)=>{const s=be("router-link"),i=be("router-view");return Ee(),ge("div",Ht,[b("nav",Nt,[oe(s,{to:"/lmem",class:Me(["nav-link",{active:e.$route.name==="lmem"}])},{default:De(()=>t[0]||(t[0]=[Ie(" LMEM 可视化 ",-1)])),_:1,__:[0]},8,["class"]),oe(s,{to:"/timestep",class:Me(["nav-link",{active:e.$route.name==="timestep"}])},{default:De(()=>t[1]||(t[1]=[Ie(" Timestep 可视化 ",-1)])),_:1,__:[1]},8,["class"])]),b("main",Wt,[oe(i)])])}}},Ft=et(Bt,[["__scopeId","data-v-bddc8c27"]]);/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const X=typeof document<"u";function it(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function Yt(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&it(n.default)}const C=Object.assign;function pe(n,e){const t={};for(const s in e){const i=e[s];t[s]=k(i)?i.map(n):n(i)}return t}const Z=()=>{},k=Array.isArray,ot=/#/g,Gt=/&/g,Xt=/\//g,zt=/=/g,$t=/\?/g,rt=/\+/g,Ut=/%5B/g,Vt=/%5D/g,at=/%5E/g,jt=/%60/g,lt=/%7B/g,qt=/%7C/g,ct=/%7D/g,Kt=/%20/g;function Te(n){return encodeURI(""+n).replace(qt,"|").replace(Ut,"[").replace(Vt,"]")}function Zt(n){return Te(n).replace(lt,"{").replace(ct,"}").replace(at,"^")}function Re(n){return Te(n).replace(rt,"%2B").replace(Kt,"+").replace(ot,"%23").replace(Gt,"%26").replace(jt,"`").replace(lt,"{").replace(ct,"}").replace(at,"^")}function Qt(n){return Re(n).replace(zt,"%3D")}function Jt(n){return Te(n).replace(ot,"%23").replace($t,"%3F")}function en(n){return n==null?"":Jt(n).replace(Xt,"%2F")}function ee(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const tn=/\/$/,nn=n=>n.replace(tn,"");function me(n,e,t="/"){let s,i={},o="",a="";const l=e.indexOf("#");let r=e.indexOf("?");return l<r&&l>=0&&(r=-1),r>-1&&(s=e.slice(0,r),o=e.slice(r+1,l>-1?l:e.length),i=n(o)),l>-1&&(s=s||e.slice(0,l),a=e.slice(l,e.length)),s=an(s??e,t),{fullPath:s+(o&&"?")+o+a,path:s,query:i,hash:ee(a)}}function sn(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function ke(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function on(n,e,t){const s=e.matched.length-1,i=t.matched.length-1;return s>-1&&s===i&&z(e.matched[s],t.matched[i])&&ht(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function z(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function ht(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!rn(n[t],e[t]))return!1;return!0}function rn(n,e){return k(n)?He(n,e):k(e)?He(e,n):n===e}function He(n,e){return k(e)?n.length===e.length&&n.every((t,s)=>t===e[s]):n.length===1&&n[0]===e}function an(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),s=n.split("/"),i=s[s.length-1];(i===".."||i===".")&&s.push("");let o=t.length-1,a,l;for(a=0;a<s.length;a++)if(l=s[a],l!==".")if(l==="..")o>1&&o--;else break;return t.slice(0,o).join("/")+"/"+s.slice(a).join("/")}const W={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var te;(function(n){n.pop="pop",n.push="push"})(te||(te={}));var Q;(function(n){n.back="back",n.forward="forward",n.unknown=""})(Q||(Q={}));function ln(n){if(!n)if(X){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),nn(n)}const cn=/^[^#]+#/;function hn(n,e){return n.replace(cn,"#")+e}function un(n,e){const t=document.documentElement.getBoundingClientRect(),s=n.getBoundingClientRect();return{behavior:e.behavior,left:s.left-t.left-(e.left||0),top:s.top-t.top-(e.top||0)}}const re=()=>({left:window.scrollX,top:window.scrollY});function dn(n){let e;if("el"in n){const t=n.el,s=typeof t=="string"&&t.startsWith("#"),i=typeof t=="string"?s?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!i)return;e=un(i,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function Ne(n,e){return(history.state?history.state.position-e:-1)+n}const ye=new Map;function fn(n,e){ye.set(n,e)}function pn(n){const e=ye.get(n);return ye.delete(n),e}let mn=()=>location.protocol+"//"+location.host;function ut(n,e){const{pathname:t,search:s,hash:i}=e,o=n.indexOf("#");if(o>-1){let l=i.includes(n.slice(o))?n.slice(o).length:1,r=i.slice(l);return r[0]!=="/"&&(r="/"+r),ke(r,"")}return ke(t,n)+s+i}function vn(n,e,t,s){let i=[],o=[],a=null;const l=({state:f})=>{const p=ut(n,location),R=t.value,y=e.value;let O=0;if(f){if(t.value=p,e.value=f,a&&a===R){a=null;return}O=y?f.position-y.position:0}else s(p);i.forEach(w=>{w(t.value,R,{delta:O,type:te.pop,direction:O?O>0?Q.forward:Q.back:Q.unknown})})};function r(){a=t.value}function h(f){i.push(f);const p=()=>{const R=i.indexOf(f);R>-1&&i.splice(R,1)};return o.push(p),p}function d(){const{history:f}=window;f.state&&f.replaceState(C({},f.state,{scroll:re()}),"")}function c(){for(const f of o)f();o=[],window.removeEventListener("popstate",l),window.removeEventListener("beforeunload",d)}return window.addEventListener("popstate",l),window.addEventListener("beforeunload",d,{passive:!0}),{pauseListeners:r,listen:h,destroy:c}}function We(n,e,t,s=!1,i=!1){return{back:n,current:e,forward:t,replaced:s,position:window.history.length,scroll:i?re():null}}function gn(n){const{history:e,location:t}=window,s={value:ut(n,t)},i={value:e.state};i.value||o(s.value,{back:null,current:s.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function o(r,h,d){const c=n.indexOf("#"),f=c>-1?(t.host&&document.querySelector("base")?n:n.slice(c))+r:mn()+n+r;try{e[d?"replaceState":"pushState"](h,"",f),i.value=h}catch(p){console.error(p),t[d?"replace":"assign"](f)}}function a(r,h){const d=C({},e.state,We(i.value.back,r,i.value.forward,!0),h,{position:i.value.position});o(r,d,!0),s.value=r}function l(r,h){const d=C({},i.value,e.state,{forward:r,scroll:re()});o(d.current,d,!0);const c=C({},We(s.value,r,null),{position:d.position+1},h);o(r,c,!1),s.value=r}return{location:s,state:i,push:l,replace:a}}function En(n){n=ln(n);const e=gn(n),t=vn(n,e.state,e.location,e.replace);function s(o,a=!0){a||t.pauseListeners(),history.go(o)}const i=C({location:"",base:n,go:s,createHref:hn.bind(null,n)},e,t);return Object.defineProperty(i,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(i,"state",{enumerable:!0,get:()=>e.state.value}),i}function wn(n){return n=location.host?n||location.pathname+location.search:"",n.includes("#")||(n+="#"),En(n)}function Rn(n){return typeof n=="string"||n&&typeof n=="object"}function dt(n){return typeof n=="string"||typeof n=="symbol"}const ft=Symbol("");var Be;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(Be||(Be={}));function $(n,e){return C(new Error,{type:n,[ft]:!0},e)}function H(n,e){return n instanceof Error&&ft in n&&(e==null||!!(n.type&e))}const Fe="[^/]+?",yn={sensitive:!1,strict:!1,start:!0,end:!0},On=/[.+*?^${}()[\]/\\]/g;function Tn(n,e){const t=C({},yn,e),s=[];let i=t.start?"^":"";const o=[];for(const h of n){const d=h.length?[]:[90];t.strict&&!h.length&&(i+="/");for(let c=0;c<h.length;c++){const f=h[c];let p=40+(t.sensitive?.25:0);if(f.type===0)c||(i+="/"),i+=f.value.replace(On,"\\$&"),p+=40;else if(f.type===1){const{value:R,repeatable:y,optional:O,regexp:w}=f;o.push({name:R,repeatable:y,optional:O});const g=w||Fe;if(g!==Fe){p+=10;try{new RegExp(`(${g})`)}catch(L){throw new Error(`Invalid custom RegExp for param "${R}" (${g}): `+L.message)}}let S=y?`((?:${g})(?:/(?:${g}))*)`:`(${g})`;c||(S=O&&h.length<2?`(?:/${S})`:"/"+S),O&&(S+="?"),i+=S,p+=20,O&&(p+=-8),y&&(p+=-20),g===".*"&&(p+=-50)}d.push(p)}s.push(d)}if(t.strict&&t.end){const h=s.length-1;s[h][s[h].length-1]+=.7000000000000001}t.strict||(i+="/?"),t.end?i+="$":t.strict&&!i.endsWith("/")&&(i+="(?:/|$)");const a=new RegExp(i,t.sensitive?"":"i");function l(h){const d=h.match(a),c={};if(!d)return null;for(let f=1;f<d.length;f++){const p=d[f]||"",R=o[f-1];c[R.name]=p&&R.repeatable?p.split("/"):p}return c}function r(h){let d="",c=!1;for(const f of n){(!c||!d.endsWith("/"))&&(d+="/"),c=!1;for(const p of f)if(p.type===0)d+=p.value;else if(p.type===1){const{value:R,repeatable:y,optional:O}=p,w=R in h?h[R]:"";if(k(w)&&!y)throw new Error(`Provided param "${R}" is an array but it is not repeatable (* or + modifiers)`);const g=k(w)?w.join("/"):w;if(!g)if(O)f.length<2&&(d.endsWith("/")?d=d.slice(0,-1):c=!0);else throw new Error(`Missing required param "${R}"`);d+=g}}return d||"/"}return{re:a,score:s,keys:o,parse:l,stringify:r}}function _n(n,e){let t=0;for(;t<n.length&&t<e.length;){const s=e[t]-n[t];if(s)return s;t++}return n.length<e.length?n.length===1&&n[0]===80?-1:1:n.length>e.length?e.length===1&&e[0]===80?1:-1:0}function pt(n,e){let t=0;const s=n.score,i=e.score;for(;t<s.length&&t<i.length;){const o=_n(s[t],i[t]);if(o)return o;t++}if(Math.abs(i.length-s.length)===1){if(Ye(s))return 1;if(Ye(i))return-1}return i.length-s.length}function Ye(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const Sn={type:0,value:""},Cn=/[a-zA-Z0-9_]/;function xn(n){if(!n)return[[]];if(n==="/")return[[Sn]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(p){throw new Error(`ERR (${t})/"${h}": ${p}`)}let t=0,s=t;const i=[];let o;function a(){o&&i.push(o),o=[]}let l=0,r,h="",d="";function c(){h&&(t===0?o.push({type:0,value:h}):t===1||t===2||t===3?(o.length>1&&(r==="*"||r==="+")&&e(`A repeatable param (${h}) must be alone in its segment. eg: '/:ids+.`),o.push({type:1,value:h,regexp:d,repeatable:r==="*"||r==="+",optional:r==="*"||r==="?"})):e("Invalid state to consume buffer"),h="")}function f(){h+=r}for(;l<n.length;){if(r=n[l++],r==="\\"&&t!==2){s=t,t=4;continue}switch(t){case 0:r==="/"?(h&&c(),a()):r===":"?(c(),t=1):f();break;case 4:f(),t=s;break;case 1:r==="("?t=2:Cn.test(r)?f():(c(),t=0,r!=="*"&&r!=="?"&&r!=="+"&&l--);break;case 2:r===")"?d[d.length-1]=="\\"?d=d.slice(0,-1)+r:t=3:d+=r;break;case 3:c(),t=0,r!=="*"&&r!=="?"&&r!=="+"&&l--,d="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${h}"`),c(),a(),i}function An(n,e,t){const s=Tn(xn(n.path),t),i=C(s,{record:n,parent:e,children:[],alias:[]});return e&&!i.record.aliasOf==!e.record.aliasOf&&e.children.push(i),i}function Pn(n,e){const t=[],s=new Map;e=$e({strict:!1,end:!0,sensitive:!1},e);function i(c){return s.get(c)}function o(c,f,p){const R=!p,y=Xe(c);y.aliasOf=p&&p.record;const O=$e(e,c),w=[y];if("alias"in c){const L=typeof c.alias=="string"?[c.alias]:c.alias;for(const F of L)w.push(Xe(C({},y,{components:p?p.record.components:y.components,path:F,aliasOf:p?p.record:y})))}let g,S;for(const L of w){const{path:F}=L;if(f&&F[0]!=="/"){const N=f.record.path,M=N[N.length-1]==="/"?"":"/";L.path=f.record.path+(F&&M+F)}if(g=An(L,f,O),p?p.alias.push(g):(S=S||g,S!==g&&S.alias.push(g),R&&c.name&&!ze(g)&&a(c.name)),mt(g)&&r(g),y.children){const N=y.children;for(let M=0;M<N.length;M++)o(N[M],g,p&&p.children[M])}p=p||g}return S?()=>{a(S)}:Z}function a(c){if(dt(c)){const f=s.get(c);f&&(s.delete(c),t.splice(t.indexOf(f),1),f.children.forEach(a),f.alias.forEach(a))}else{const f=t.indexOf(c);f>-1&&(t.splice(f,1),c.record.name&&s.delete(c.record.name),c.children.forEach(a),c.alias.forEach(a))}}function l(){return t}function r(c){const f=Dn(c,t);t.splice(f,0,c),c.record.name&&!ze(c)&&s.set(c.record.name,c)}function h(c,f){let p,R={},y,O;if("name"in c&&c.name){if(p=s.get(c.name),!p)throw $(1,{location:c});O=p.record.name,R=C(Ge(f.params,p.keys.filter(S=>!S.optional).concat(p.parent?p.parent.keys.filter(S=>S.optional):[]).map(S=>S.name)),c.params&&Ge(c.params,p.keys.map(S=>S.name))),y=p.stringify(R)}else if(c.path!=null)y=c.path,p=t.find(S=>S.re.test(y)),p&&(R=p.parse(y),O=p.record.name);else{if(p=f.name?s.get(f.name):t.find(S=>S.re.test(f.path)),!p)throw $(1,{location:c,currentLocation:f});O=p.record.name,R=C({},f.params,c.params),y=p.stringify(R)}const w=[];let g=p;for(;g;)w.unshift(g.record),g=g.parent;return{name:O,path:y,params:R,matched:w,meta:bn(w)}}n.forEach(c=>o(c));function d(){t.length=0,s.clear()}return{addRoute:o,resolve:h,removeRoute:a,clearRoutes:d,getRoutes:l,getRecordMatcher:i}}function Ge(n,e){const t={};for(const s of e)s in n&&(t[s]=n[s]);return t}function Xe(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:Ln(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function Ln(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const s in n.components)e[s]=typeof t=="object"?t[s]:t;return e}function ze(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function bn(n){return n.reduce((e,t)=>C(e,t.meta),{})}function $e(n,e){const t={};for(const s in n)t[s]=s in e?e[s]:n[s];return t}function Dn(n,e){let t=0,s=e.length;for(;t!==s;){const o=t+s>>1;pt(n,e[o])<0?s=o:t=o+1}const i=In(n);return i&&(s=e.lastIndexOf(i,s-1)),s}function In(n){let e=n;for(;e=e.parent;)if(mt(e)&&pt(n,e)===0)return e}function mt({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function Mn(n){const e={};if(n===""||n==="?")return e;const s=(n[0]==="?"?n.slice(1):n).split("&");for(let i=0;i<s.length;++i){const o=s[i].replace(rt," "),a=o.indexOf("="),l=ee(a<0?o:o.slice(0,a)),r=a<0?null:ee(o.slice(a+1));if(l in e){let h=e[l];k(h)||(h=e[l]=[h]),h.push(r)}else e[l]=r}return e}function Ue(n){let e="";for(let t in n){const s=n[t];if(t=Qt(t),s==null){s!==void 0&&(e+=(e.length?"&":"")+t);continue}(k(s)?s.map(o=>o&&Re(o)):[s&&Re(s)]).forEach(o=>{o!==void 0&&(e+=(e.length?"&":"")+t,o!=null&&(e+="="+o))})}return e}function kn(n){const e={};for(const t in n){const s=n[t];s!==void 0&&(e[t]=k(s)?s.map(i=>i==null?null:""+i):s==null?s:""+s)}return e}const Hn=Symbol(""),Ve=Symbol(""),_e=Symbol(""),vt=Symbol(""),Oe=Symbol("");function q(){let n=[];function e(s){return n.push(s),()=>{const i=n.indexOf(s);i>-1&&n.splice(i,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function B(n,e,t,s,i,o=a=>a()){const a=s&&(s.enterCallbacks[i]=s.enterCallbacks[i]||[]);return()=>new Promise((l,r)=>{const h=f=>{f===!1?r($(4,{from:t,to:e})):f instanceof Error?r(f):Rn(f)?r($(2,{from:e,to:f})):(a&&s.enterCallbacks[i]===a&&typeof f=="function"&&a.push(f),l())},d=o(()=>n.call(s&&s.instances[i],e,t,h));let c=Promise.resolve(d);n.length<3&&(c=c.then(h)),c.catch(f=>r(f))})}function ve(n,e,t,s,i=o=>o()){const o=[];for(const a of n)for(const l in a.components){let r=a.components[l];if(!(e!=="beforeRouteEnter"&&!a.instances[l]))if(it(r)){const d=(r.__vccOpts||r)[e];d&&o.push(B(d,t,s,a,l,i))}else{let h=r();o.push(()=>h.then(d=>{if(!d)throw new Error(`Couldn't resolve component "${l}" at "${a.path}"`);const c=Yt(d)?d.default:d;a.mods[l]=d,a.components[l]=c;const p=(c.__vccOpts||c)[e];return p&&B(p,t,s,a,l,i)()}))}}return o}function je(n){const e=J(_e),t=J(vt),s=I(()=>{const r=K(n.to);return e.resolve(r)}),i=I(()=>{const{matched:r}=s.value,{length:h}=r,d=r[h-1],c=t.matched;if(!d||!c.length)return-1;const f=c.findIndex(z.bind(null,d));if(f>-1)return f;const p=qe(r[h-2]);return h>1&&qe(d)===p&&c[c.length-1].path!==p?c.findIndex(z.bind(null,r[h-2])):f}),o=I(()=>i.value>-1&&Yn(t.params,s.value.params)),a=I(()=>i.value>-1&&i.value===t.matched.length-1&&ht(t.params,s.value.params));function l(r={}){if(Fn(r)){const h=e[K(n.replace)?"replace":"push"](K(n.to)).catch(Z);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>h),h}return Promise.resolve()}return{route:s,href:I(()=>s.value.href),isActive:o,isExactActive:a,navigate:l}}function Nn(n){return n.length===1?n[0]:n}const Wn=tt({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:je,setup(n,{slots:e}){const t=Tt(je(n)),{options:s}=J(_e),i=I(()=>({[Ke(n.activeClass,s.linkActiveClass,"router-link-active")]:t.isActive,[Ke(n.exactActiveClass,s.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const o=e.default&&Nn(e.default(t));return n.custom?o:nt("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:i.value},o)}}}),Bn=Wn;function Fn(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function Yn(n,e){for(const t in e){const s=e[t],i=n[t];if(typeof s=="string"){if(s!==i)return!1}else if(!k(i)||i.length!==s.length||s.some((o,a)=>o!==i[a]))return!1}return!0}function qe(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const Ke=(n,e,t)=>n??e??t,Gn=tt({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const s=J(Oe),i=I(()=>n.route||s.value),o=J(Ve,0),a=I(()=>{let h=K(o);const{matched:d}=i.value;let c;for(;(c=d[h])&&!c.components;)h++;return h}),l=I(()=>i.value.matched[a.value]);fe(Ve,I(()=>a.value+1)),fe(Hn,l),fe(Oe,i);const r=G();return Ot(()=>[r.value,l.value,n.name],([h,d,c],[f,p,R])=>{d&&(d.instances[c]=h,p&&p!==d&&h&&h===f&&(d.leaveGuards.size||(d.leaveGuards=p.leaveGuards),d.updateGuards.size||(d.updateGuards=p.updateGuards))),h&&d&&(!p||!z(d,p)||!f)&&(d.enterCallbacks[c]||[]).forEach(y=>y(h))},{flush:"post"}),()=>{const h=i.value,d=n.name,c=l.value,f=c&&c.components[d];if(!f)return Ze(t.default,{Component:f,route:h});const p=c.props[d],R=p?p===!0?h.params:typeof p=="function"?p(h):p:null,O=nt(f,C({},R,e,{onVnodeUnmounted:w=>{w.component.isUnmounted&&(c.instances[d]=null)},ref:r}));return Ze(t.default,{Component:O,route:h})||O}}});function Ze(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const Xn=Gn;function zn(n){const e=Pn(n.routes,n),t=n.parseQuery||Mn,s=n.stringifyQuery||Ue,i=n.history,o=q(),a=q(),l=q(),r=Rt(W);let h=W;X&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const d=pe.bind(null,u=>""+u),c=pe.bind(null,en),f=pe.bind(null,ee);function p(u,v){let m,E;return dt(u)?(m=e.getRecordMatcher(u),E=v):E=u,e.addRoute(E,m)}function R(u){const v=e.getRecordMatcher(u);v&&e.removeRoute(v)}function y(){return e.getRoutes().map(u=>u.record)}function O(u){return!!e.getRecordMatcher(u)}function w(u,v){if(v=C({},v||r.value),typeof u=="string"){const T=me(t,u,v.path),P=e.resolve({path:T.path},v),V=i.createHref(T.fullPath);return C(T,P,{params:f(P.params),hash:ee(T.hash),redirectedFrom:void 0,href:V})}let m;if(u.path!=null)m=C({},u,{path:me(t,u.path,v.path).path});else{const T=C({},u.params);for(const P in T)T[P]==null&&delete T[P];m=C({},u,{params:c(T)}),v.params=c(v.params)}const E=e.resolve(m,v),x=u.hash||"";E.params=d(f(E.params));const A=sn(s,C({},u,{hash:Zt(x),path:E.path})),_=i.createHref(A);return C({fullPath:A,hash:x,query:s===Ue?kn(u.query):u.query||{}},E,{redirectedFrom:void 0,href:_})}function g(u){return typeof u=="string"?me(t,u,r.value.path):C({},u)}function S(u,v){if(h!==u)return $(8,{from:v,to:u})}function L(u){return M(u)}function F(u){return L(C(g(u),{replace:!0}))}function N(u){const v=u.matched[u.matched.length-1];if(v&&v.redirect){const{redirect:m}=v;let E=typeof m=="function"?m(u):m;return typeof E=="string"&&(E=E.includes("?")||E.includes("#")?E=g(E):{path:E},E.params={}),C({query:u.query,hash:u.hash,params:E.path!=null?{}:u.params},E)}}function M(u,v){const m=h=w(u),E=r.value,x=u.state,A=u.force,_=u.replace===!0,T=N(m);if(T)return M(C(g(T),{state:typeof T=="object"?C({},x,T.state):x,force:A,replace:_}),v||m);const P=m;P.redirectedFrom=v;let V;return!A&&on(s,E,m)&&(V=$(16,{to:P,from:E}),Pe(E,E,!0,!1)),(V?Promise.resolve(V):Se(P,E)).catch(D=>H(D)?H(D,2)?D:he(D):ce(D,P,E)).then(D=>{if(D){if(H(D,2))return M(C({replace:_},g(D.to),{state:typeof D.to=="object"?C({},x,D.to.state):x,force:A}),v||P)}else D=xe(P,E,!0,_,x);return Ce(P,E,D),D})}function gt(u,v){const m=S(u,v);return m?Promise.reject(m):Promise.resolve()}function ae(u){const v=se.values().next().value;return v&&typeof v.runWithContext=="function"?v.runWithContext(u):u()}function Se(u,v){let m;const[E,x,A]=$n(u,v);m=ve(E.reverse(),"beforeRouteLeave",u,v);for(const T of E)T.leaveGuards.forEach(P=>{m.push(B(P,u,v))});const _=gt.bind(null,u,v);return m.push(_),Y(m).then(()=>{m=[];for(const T of o.list())m.push(B(T,u,v));return m.push(_),Y(m)}).then(()=>{m=ve(x,"beforeRouteUpdate",u,v);for(const T of x)T.updateGuards.forEach(P=>{m.push(B(P,u,v))});return m.push(_),Y(m)}).then(()=>{m=[];for(const T of A)if(T.beforeEnter)if(k(T.beforeEnter))for(const P of T.beforeEnter)m.push(B(P,u,v));else m.push(B(T.beforeEnter,u,v));return m.push(_),Y(m)}).then(()=>(u.matched.forEach(T=>T.enterCallbacks={}),m=ve(A,"beforeRouteEnter",u,v,ae),m.push(_),Y(m))).then(()=>{m=[];for(const T of a.list())m.push(B(T,u,v));return m.push(_),Y(m)}).catch(T=>H(T,8)?T:Promise.reject(T))}function Ce(u,v,m){l.list().forEach(E=>ae(()=>E(u,v,m)))}function xe(u,v,m,E,x){const A=S(u,v);if(A)return A;const _=v===W,T=X?history.state:{};m&&(E||_?i.replace(u.fullPath,C({scroll:_&&T&&T.scroll},x)):i.push(u.fullPath,x)),r.value=u,Pe(u,v,m,_),he()}let U;function Et(){U||(U=i.listen((u,v,m)=>{if(!Le.listening)return;const E=w(u),x=N(E);if(x){M(C(x,{replace:!0,force:!0}),E).catch(Z);return}h=E;const A=r.value;X&&fn(Ne(A.fullPath,m.delta),re()),Se(E,A).catch(_=>H(_,12)?_:H(_,2)?(M(C(g(_.to),{force:!0}),E).then(T=>{H(T,20)&&!m.delta&&m.type===te.pop&&i.go(-1,!1)}).catch(Z),Promise.reject()):(m.delta&&i.go(-m.delta,!1),ce(_,E,A))).then(_=>{_=_||xe(E,A,!1),_&&(m.delta&&!H(_,8)?i.go(-m.delta,!1):m.type===te.pop&&H(_,20)&&i.go(-1,!1)),Ce(E,A,_)}).catch(Z)}))}let le=q(),Ae=q(),ne;function ce(u,v,m){he(u);const E=Ae.list();return E.length?E.forEach(x=>x(u,v,m)):console.error(u),Promise.reject(u)}function wt(){return ne&&r.value!==W?Promise.resolve():new Promise((u,v)=>{le.add([u,v])})}function he(u){return ne||(ne=!u,Et(),le.list().forEach(([v,m])=>u?m(u):v()),le.reset()),u}function Pe(u,v,m,E){const{scrollBehavior:x}=n;if(!X||!x)return Promise.resolve();const A=!m&&pn(Ne(u.fullPath,0))||(E||!m)&&history.state&&history.state.scroll||null;return st().then(()=>x(u,v,A)).then(_=>_&&dn(_)).catch(_=>ce(_,u,v))}const ue=u=>i.go(u);let de;const se=new Set,Le={currentRoute:r,listening:!0,addRoute:p,removeRoute:R,clearRoutes:e.clearRoutes,hasRoute:O,getRoutes:y,resolve:w,options:n,push:L,replace:F,go:ue,back:()=>ue(-1),forward:()=>ue(1),beforeEach:o.add,beforeResolve:a.add,afterEach:l.add,onError:Ae.add,isReady:wt,install(u){const v=this;u.component("RouterLink",Bn),u.component("RouterView",Xn),u.config.globalProperties.$router=v,Object.defineProperty(u.config.globalProperties,"$route",{enumerable:!0,get:()=>K(r)}),X&&!de&&r.value===W&&(de=!0,L(i.location).catch(x=>{}));const m={};for(const x in W)Object.defineProperty(m,x,{get:()=>r.value[x],enumerable:!0});u.provide(_e,v),u.provide(vt,yt(m)),u.provide(Oe,r);const E=u.unmount;se.add(u),u.unmount=function(){se.delete(u),se.size<1&&(h=W,U&&U(),U=null,r.value=W,de=!1,ne=!1),E()}}};function Y(u){return u.reduce((v,m)=>v.then(()=>ae(m)),Promise.resolve())}return Le}function $n(n,e){const t=[],s=[],i=[],o=Math.max(e.matched.length,n.matched.length);for(let a=0;a<o;a++){const l=e.matched[a];l&&(n.matched.find(h=>z(h,l))?s.push(l):t.push(l));const r=n.matched[a];r&&(e.matched.find(h=>z(h,r))||i.push(r))}return[t,s,i]}function Un(){var n=new we(4);return we!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function Qe(n,e,t,s){var i=new we(4);return i[0]=n,i[1]=e,i[2]=t,i[3]=s,i}function Je(n,e,t){var s=e[0],i=e[1],o=e[2],a=e[3];return n[0]=t[0]*s+t[4]*i+t[8]*o+t[12]*a,n[1]=t[1]*s+t[5]*i+t[9]*o+t[13]*a,n[2]=t[2]*s+t[6]*i+t[10]*o+t[14]*a,n[3]=t[3]*s+t[7]*i+t[11]*o+t[15]*a,n}(function(){var n=Un();return function(e,t,s,i,o,a){var l,r;for(t||(t=4),s||(s=0),i?r=Math.min(i*t+s,e.length):r=e.length,l=s;l<r;l+=t)n[0]=e[l],n[1]=e[l+1],n[2]=e[l+2],n[3]=e[l+3],o(n,n,a),e[l]=n[0],e[l+1]=n[1],e[l+2]=n[2],e[l+3]=n[3];return e}})();class Vn{constructor({canvas:e,tooltipElement:t,onOperationSelect:s=()=>{},onOperationHover:i=()=>{}}){this.canvas=e,this.gl=e.getContext("webgl")||e.getContext("experimental-webgl"),this.tooltipElement=t,this.onOperationSelect=s,this.onOperationHover=i,this.program=null,this.overlayProgram=null,this.buffers={},this.uniforms={},this.overlayUniforms={},this.attributes={},this.overlayAttributes={},this.projectionMatrix=j(),this.viewMatrix=j(),this.viewProjectionMatrix=j(),this.orthoMatrix=j(),this.overlayCanvas=document.createElement("canvas"),this.overlayCtx=this.overlayCanvas.getContext("2d"),this.overlayTexture=null,this.data=null,this.zoomLevel=1,this.viewOffset=0,this.hoveredOperation=null,this.selectedOperations=new Set,this.dependencies={},this.animationFrame=null,this.lanes=[{id:"stores",label:"存储操作",color:[.882,.341,.349,1]},{id:"compute",label:"计算操作",color:[.305,.557,.655,1]},{id:"loads",label:"加载操作",color:[.949,.557,.173,1]}],this.fixedLeft=80,this.translateX=0,this.WORLD_COORDS={AXIS_Y:-3,TOP_Y:1.2,LANE_START_Y:-1.8,LANE_HEIGHT:.8,LABEL_OFFSET_X:-.5,TICK_LENGTH:.2},this.RECT_COORDS={LANE_START_Y:-1.8,LANE_HEIGHT:.8,RECT_HEIGHT_RATIO:.5,LANE_MARGIN:.2},this.timeStepBaseWidth=50,this.stepInterval=1,this.minZoom=1e-4,this.maxZoom=5,this.isDragging=!1,this.dragStartX=0,this.startViewOffset=0,this.dependencies={downstream:{},upstream:{}},this.gl?this.initWebGL():console.error("WebGL not supported"),this.bindEvents(),this.resize()}initWebGL(){const e=this.gl;this.gl.enable(this.gl.POLYGON_OFFSET_FILL),this.gl.polygonOffset(1,1),this.gl.disable(this.gl.SMOOTH),this.gl.disable(this.gl.DITHER);const t=`
      attribute vec2 aPosition;
      attribute vec4 aColor;
      uniform mat4 uViewProjectionMatrix;
      varying vec4 vColor;
      
      void main() {
        gl_Position = uViewProjectionMatrix * vec4(aPosition, 0.0, 1.0);
        vColor = aColor;
      }
    `,s=`
      precision mediump float;
      varying vec4 vColor;
      
      void main() {
        gl_FragColor = vColor ;
      }
    `;this.program=this.createProgram(t,s);const i=`
      attribute vec2 aPosition;
      attribute vec2 aTexCoord;
      varying vec2 vTexCoord;
      
      void main() {
        gl_Position = vec4(aPosition, 0.0, 1.0);
        vTexCoord = aTexCoord;
      }
    `,o=`
      precision mediump float;
      varying vec2 vTexCoord;
      uniform sampler2D uTexture;
      
      void main() {
        gl_FragColor = texture2D(uTexture, vTexCoord);
      }
    `;this.overlayProgram=this.createProgram(i,o),e.useProgram(this.program),this.uniforms.viewProjectionMatrix=e.getUniformLocation(this.program,"uViewProjectionMatrix"),this.attributes.position=e.getAttribLocation(this.program,"aPosition"),this.attributes.color=e.getAttribLocation(this.program,"aColor"),e.useProgram(this.overlayProgram),this.overlayUniforms.texture=e.getUniformLocation(this.overlayProgram,"uTexture"),this.overlayAttributes.position=e.getAttribLocation(this.overlayProgram,"aPosition"),this.overlayAttributes.texCoord=e.getAttribLocation(this.overlayProgram,"aTexCoord"),this.buffers.operations=e.createBuffer(),this.buffers.lanes=e.createBuffer(),this.buffers.overlay=e.createBuffer(),this.buffers.overlayTexCoords=e.createBuffer(),this.overlayTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.overlayTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)}createProgram(e,t){const s=this.gl,i=this.compileShader(s.VERTEX_SHADER,e),o=this.compileShader(s.FRAGMENT_SHADER,t),a=s.createProgram();if(s.attachShader(a,i),s.attachShader(a,o),s.linkProgram(a),!s.getProgramParameter(a,s.LINK_STATUS))throw new Error("Program linking error: "+s.getProgramInfoLog(a));return a}compileShader(e,t){const s=this.gl,i=s.createShader(e);if(s.shaderSource(i,t),s.compileShader(i),!s.getShaderParameter(i,s.COMPILE_STATUS))throw new Error("Shader compilation error: "+s.getShaderInfoLog(i));return i}resize(){const e=window.devicePixelRatio||1;this.canvas.width=this.canvas.clientWidth*e,this.canvas.height=this.canvas.clientHeight*e,this.overlayCanvas.width=this.canvas.width,this.overlayCanvas.height=this.canvas.height;const t=this.fixedLeft*e,s=this.canvas.width-t;if(this.gl.viewport(t,0,s,this.canvas.height),this.data){const i=(this.canvas.width-this.fixedLeft*e)/e,o=this.timeStepBaseWidth*this.zoomLevel,a=i/o,l=Math.max(0,this.data.length-a);this.viewOffset=Math.min(l,this.viewOffset)}this.render()}setData(e){console.log("setData called with",e),this.data=e,this.viewOffset=0,this.analyzeDependencies(),console.log("Dependencies-downstream raw:",JSON.parse(JSON.stringify(this.dependencies.downstream))),console.log("Dependencies-upstream   raw:",JSON.parse(JSON.stringify(this.dependencies.upstream))),this.render()}updateMatrices(){if(!this.data)return;const e=window.devicePixelRatio||1,t=2,s=(this.canvas.width-this.fixedLeft*e)/e,i=this.timeStepBaseWidth*this.zoomLevel,o=s/i,a=this.data.length+1;this.viewOffset=Math.max(-1,Math.min(a,this.viewOffset));const l=Math.max(-t,this.viewOffset-t),r=Math.min(this.data.length+t,this.viewOffset+o+t),h=this.WORLD_COORDS.AXIS_Y-.5,d=this.WORLD_COORDS.TOP_Y+.5;_t(this.projectionMatrix,l,r,h,d,-1,1),St(this.viewMatrix);const c=(0-l)/(r-l)*2-1,p=(-1+this.fixedLeft/(s+this.fixedLeft)*2-c)*(r-l)/2;Ct(this.viewMatrix,this.viewMatrix,[p,0,0]),xt(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix)}worldToScreen(e,t){const s=window.devicePixelRatio||1,i=Qe(e,t,0,1);Je(i,i,this.viewProjectionMatrix);const o=i[0]/i[3],a=i[1]/i[3],l=0,r=this.canvas.width-l,h=this.canvas.height,d=l+(o+1)*.5*r,c=(1-a)*.5*h;return[d*s,c*s]}screenToWorld(e,t){const s=window.devicePixelRatio||1,i=e/s,o=t/s,a=0,l=this.canvas.width-a,r=this.canvas.height,h=2*(i-a)/l-1,d=1-2*o/r,c=Qe(h,d,0,1),f=j();At(f,this.viewProjectionMatrix),Je(c,c,f);const p=c[0]/c[3],R=c[1]/c[3];return[p,R]}render(){!this.gl||!this.data||(this.animationFrame&&cancelAnimationFrame(this.animationFrame),this.animationFrame=requestAnimationFrame(()=>{this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clearColor(.98,.98,.98,1),this.gl.disable(this.gl.DEPTH_TEST),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.updateMatrices(),this.drawOperations(),this.drawOverlay(),console.log({zoomLevel:this.zoomLevel,viewOffset:this.viewOffset})}))}drawLanes(){const e=this.gl;e.useProgram(this.program),e.uniformMatrix4fv(this.uniforms.viewProjectionMatrix,!1,this.viewProjectionMatrix);const t=[],s=[];this.lanes.forEach((i,o)=>{const a=this.RECT_COORDS.LABEL_OFFSET_X,l=this.RECT_COORDS.LANE_START_Y+o*this.RECT_COORDS.LANE_HEIGHT+this.RECT_COORDS.LANE_HEIGHT*this.RECT_COORDS.RECT_HEIGHT_RATIO/2,r=this.worldToScreen(a,l)[1],h=this.RECT_COORDS.LANE_HEIGHT*this.RECT_COORDS.RECT_HEIGHT_RATIO,d=[-100,r,100,r,-100,r+h,-100,r+h,100,r,100,r+h];t.push(...d);const c=[...i.color];c[3]=.3;for(let f=0;f<6;f++)s.push(...c)}),this.drawGeometry(t,s,this.buffers.lanes)}drawOperations(){const e=this.gl;e.useProgram(this.program),e.uniformMatrix4fv(this.uniforms.viewProjectionMatrix,!1,this.viewProjectionMatrix);const t=[],s=[],{startTs:i,endTs:o}=this.getVisibleTimeStepRange();for(let a=i;a<=o;a++){const l=this.data[a];l&&["stores","loads","compute"].forEach(r=>{l[r]&&l[r].forEach(h=>{this.addOperationGeometry(t,s,h,r,a)})})}t.length>0&&(console.log("绘制操作矩形"),this.drawGeometry(t,s,this.buffers.operations))}addOperationGeometry(e,t,s,i,o){const a=this.lanes.findIndex(L=>L.id===i);if(a===-1)return;const l=this.RECT_COORDS.LANE_START_Y+a*this.RECT_COORDS.LANE_HEIGHT,r=this.RECT_COORDS.LANE_HEIGHT*this.RECT_COORDS.RECT_HEIGHT_RATIO,h=this.data[o],d=h[i]?h[i].length:1,c=h[i].indexOf(s),p=1/d,R=o+c*p,y=p,O=this.hoveredOperation&&this.hoveredOperation.op&&this.hoveredOperation.op.id===s.id,w=this.selectedOperations.has(s.id);let g=Pt.getColorForOperator(s.id,1);O?g=[1,0,0,.3]:w&&(g=[0,1,0,.8]);const S=[R,l,R+y,l,R,l+r,R,l+r,R+y,l,R+y,l+r];e.push(...S);for(let L=0;L<6;L++)t.push(...g)}drawGeometry(e,t,s){const i=this.gl;console.log("绘制几何体 - 顶点数:",e.length/2);const o=new Float32Array(e.length/2*6);for(let a=0;a<e.length/2;a++)o[a*6]=e[a*2],o[a*6+1]=e[a*2+1],o[a*6+2]=t[a*4],o[a*6+3]=t[a*4+1],o[a*6+4]=t[a*4+2],o[a*6+5]=t[a*4+3];i.bindBuffer(i.ARRAY_BUFFER,s),i.bufferData(i.ARRAY_BUFFER,o,i.DYNAMIC_DRAW),i.enableVertexAttribArray(this.attributes.position),i.enableVertexAttribArray(this.attributes.color),i.vertexAttribPointer(this.attributes.position,2,i.FLOAT,!1,24,0),i.vertexAttribPointer(this.attributes.color,4,i.FLOAT,!1,24,8),i.drawArrays(i.TRIANGLES,0,e.length/2)}drawFixedLeftPanel(){const e=this.overlayCtx,t=window.devicePixelRatio||1,s=0,i=this.fixedLeft*t,o=this.overlayCanvas.height;e.save(),e.beginPath(),e.rect(s,0,i,o),e.clip(),e.fillStyle="#f7f7f7",e.fillRect(s,0,i,o),e.textAlign="right",e.textBaseline="middle",e.font=`${16*t}px Arial`,e.fillStyle="#333",this.lanes.forEach((r,h)=>{const d=this.RECT_COORDS.LANE_START_Y+h*this.RECT_COORDS.LANE_HEIGHT+this.RECT_COORDS.LANE_HEIGHT*this.RECT_COORDS.RECT_HEIGHT_RATIO/2,c=this.worldToScreen(0,d)[1];e.fillText(r.id,i-10*t,c)}),e.textAlign="left",e.textBaseline="middle",e.font=`${14*t}px Arial`;const a=this.WORLD_COORDS.AXIS_Y-.3,l=this.worldToScreen(0,a)[1];e.fillText("TimeSteps",s+10*t,l),e.restore()}drawAlignmentLinesWithCanvas2D(){const e=this.overlayCtx,t=window.devicePixelRatio||1;if(!this.data||this.data.length===0)return;const{startTs:s,endTs:i}=this.getVisibleTimeStepRange(),o=this.WORLD_COORDS.TOP_Y,a=this.WORLD_COORDS.AXIS_Y;e.strokeStyle="#544f4fff",e.lineWidth=1*t,e.setLineDash([2*t,2*t]);for(let l=s;l<=i;l++){const[r,h]=this.worldToScreen(l,o),[d,c]=this.worldToScreen(l,a);e.beginPath(),e.moveTo(r,h),e.lineTo(d,c),e.stroke()}e.setLineDash([])}drawTimelineWithCanvas2D(){const e=this.overlayCtx,t=window.devicePixelRatio||1;if(!this.data||this.data.length===0)return;const{startTs:s,endTs:i}=this.getVisibleTimeStepRange(),o=this.WORLD_COORDS.AXIS_Y,[a,l]=this.worldToScreen(s,o),[r,h]=this.worldToScreen(i,o);e.beginPath(),e.moveTo(a,l),e.lineTo(r,h),e.strokeStyle="#120c0cff",e.lineWidth=1*t,e.stroke();const d=this.calculateStepInterval(i-s);e.font=`${12*t}px Arial`,e.fillStyle="#333",e.textAlign="center",e.textBaseline="top";for(let c=s;c<=i;c++){const[f,p]=this.worldToScreen(c,o),[R,y]=this.worldToScreen(c,o-.3),O=c%d===0;if(O||(c===s||c===i)){e.beginPath();const g=O?10*t:6*t;e.moveTo(f,p-g),e.lineTo(f,p),e.strokeStyle=O?"#444":"#888",e.lineWidth=O?1.5*t:1*t,e.stroke(),O&&e.fillText(`T${c}`,R,y+5*t)}}this.debugCoordinateSystems()}calculateStepInterval(e){if(e<=0)return 1;const t=80,i=(this.canvas.width-this.fixedLeft*window.devicePixelRatio)/e;let o=1;return i<t&&(o=Math.ceil(t/i)),o>20?o=20:o>10?o=10:o>5?o=5:o>2&&(o=2),o}drawOverlay(){const e=window.devicePixelRatio||1;this.overlayCtx.clearRect(0,0,this.overlayCanvas.width,this.overlayCanvas.height),this.drawFixedLeftPanel(),this.overlayCtx.save(),this.overlayCtx.beginPath(),this.overlayCtx.rect(this.fixedLeft*e,0,this.overlayCanvas.width-this.fixedLeft*e,this.overlayCanvas.height),this.overlayCtx.clip(),this.drawTimelineWithCanvas2D(),this.drawAlignmentLinesWithCanvas2D(),this.drawDependenciesWithCanvas2D(),this.overlayCtx.restore(),this.renderOverlayTexture()}analyzeDependencies(){this.dependencies={downstream:{},upstream:{}};for(let e=0;e<this.data.length;e++)["loads","compute","stores"].forEach(t=>{this.data[e][t]&&this.data[e][t].forEach(s=>{const i=this.findDownstreamDependencies(s,e);i.length&&(this.dependencies.downstream[s.id]=i,i.forEach(o=>{this.dependencies.upstream[o.op.id]||(this.dependencies.upstream[o.op.id]=[]),this.dependencies.upstream[o.op.id].push({type:t,ts:e,op:s})}))})})}findDownstreamDependencies(e,t){const s=[];for(let i=t+1;i<this.data.length;i++)["loads","compute","stores"].forEach(o=>{if(!this.data[i][o])return;const a=this.data[i][o].find(l=>l.id===e.id);a&&s.push({type:o,ts:i,op:a})});return s}drawDependenciesWithCanvas2D(){console.log("drawDependenciesWithCanvas2D: selectedOperations =",this.selectedOperations);const e=window.devicePixelRatio||1;this.selectedOperations.forEach(t=>{this.dependencies.downstream[t]&&this.dependencies.downstream[t].forEach(s=>{const i=this.findOperationById(t),o={op:s.op,type:s.type,ts:s.ts};this.drawDependencyArrow(i,o,e,"#ff6b6b",2)}),this.dependencies.upstream[t]&&this.dependencies.upstream[t].forEach(s=>{const i={op:s.op,type:s.type,ts:s.ts},o=this.findOperationById(t);this.drawDependencyArrow(i,o,e,"#4ecdc4",2)})})}drawDependencyArrow(e,t,s,i,o){const a=this._getOpCenter(e),l=this._getOpCenter(t);if(!a||!l)return;const r=this.overlayCtx;r.beginPath(),r.moveTo(a.x,a.y);const h=Math.abs(l.x-a.x)*.4;r.bezierCurveTo(a.x+h,a.y,l.x-h,l.y,l.x,l.y),r.strokeStyle=i,r.lineWidth=o*s,r.setLineDash([]),r.stroke();const d=Math.atan2(l.y-a.y,l.x-a.x);r.save(),r.translate(l.x,l.y),r.rotate(d),r.fillStyle=i,r.beginPath(),r.moveTo(0,0),r.lineTo(-8*s,-4*s),r.lineTo(-8*s,4*s),r.closePath(),r.fill(),r.restore()}_getOpCenter({op:e,type:t,ts:s}){const i=this.lanes.findIndex(p=>p.id===t);if(i===-1)return null;const o=this.data[s],a=o[t]?o[t].length:1,l=o[t]?o[t].indexOf(e):0,r=1/a,h=s+l*r+r,d=this.RECT_COORDS.LANE_START_Y+i*this.RECT_COORDS.LANE_HEIGHT+this.RECT_COORDS.LANE_HEIGHT*this.RECT_COORDS.RECT_HEIGHT_RATIO/2,[c,f]=this.worldToScreen(h,d);return{x:c,y:f}}drawLaneLabelsWithCanvas2D(){const e=this.overlayCtx,t=window.devicePixelRatio||1;this.lanes.forEach((s,i)=>{const o=this.RECT_COORDS.LANE_START_Y+i*this.RECT_COORDS.LANE_HEIGHT+this.RECT_COORDS.LANE_HEIGHT*this.RECT_COORDS.RECT_HEIGHT_RATIO/2,a=-1,[l,r]=this.worldToScreen(a,o);e.fillStyle="#333",e.font=`${16*t}px Arial`,e.textAlign="right",e.textBaseline="middle",e.fillText(s.id,l,r)})}renderOverlayTexture(){const e=this.gl;e.bindTexture(e.TEXTURE_2D,this.overlayTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.overlayCanvas),e.useProgram(this.overlayProgram),e.uniform1i(this.overlayUniforms.texture,0);const t=new Float32Array([-1,-1,0,1,1,-1,1,1,-1,1,0,0,-1,1,0,0,1,-1,1,1,1,1,1,0]);e.bindBuffer(e.ARRAY_BUFFER,this.buffers.overlay),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.vertexAttribPointer(this.overlayAttributes.position,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(this.overlayAttributes.texCoord,2,e.FLOAT,!1,16,8),e.drawArrays(e.TRIANGLES,0,6),e.enable(e.BLEND)}bindEvents(){this.canvas.addEventListener("wheel",this.handleWheel.bind(this)),this.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.canvas.addEventListener("mouseleave",this.handleMouseLeave.bind(this)),this.canvas.addEventListener("click",this.handleClick.bind(this)),window.addEventListener("resize",this.resize.bind(this))}handleWheel(e){e.preventDefault();const t=this.canvas.getBoundingClientRect(),s=e.clientX-t.left,i=this.screenToWorld(s,0)[0],o=e.deltaY>0?-.1:.1,a=this.zoomLevel;this.zoomLevel=Math.max(this.minZoom,Math.min(this.maxZoom,this.zoomLevel+o));const l=a/this.zoomLevel,r=i;this.viewOffset=this.viewOffset+(i-r)*l,this.render()}handleMouseMove(e){const{x:t,y:s}=this.getCanvasRelativePosition(e),i=window.devicePixelRatio||1,o=t*i,a=s*i;if(this.isDragging){const[r,h]=this.screenToWorld(t,s),d=this.dragStartWorldX-r,c=this.startViewOffset+d,{x0:f,x1:p}=this.getVisibleTimeStepRange();this.viewOffset=Math.max(0,c),this.render();return}const l=this.hoveredOperation;this.hoveredOperation=this.findOperationAt(o,a),this.updateTooltip(t,s),l!==this.hoveredOperation&&this.render(),this.hoveredOperation&&this.onOperationHover(this.hoveredOperation)}getCanvasRelativePosition(e){const t=this.canvas.getBoundingClientRect(),s=getComputedStyle(this.canvas),i=parseInt(s.borderLeftWidth)||0,o=parseInt(s.borderTopWidth)||0,a=window.scrollX||window.pageXOffset,l=window.scrollY||window.pageYOffset;return{x:e.clientX+a-t.left-i,y:e.clientY+l-t.top-o}}handleMouseDown(e){this.isDragging=!0,this.dragStartX=e.clientX,this.startViewOffset=this.viewOffset;const{x:t,y:s}=this.getCanvasRelativePosition(e),[i,o]=this.screenToWorld(t,s);this.dragStartWorldX=i,e.preventDefault()}handleMouseUp(){this.isDragging=!1}handleMouseLeave(){this.isDragging=!1,this.hoveredOperation=null,this.updateTooltip(),this.render()}handleClick(e){if(!this.data||!this.hoveredOperation)return;const t=this.hoveredOperation.op.id;this.selectedOperations.clear(),this.selectedOperations.add(t),this.dependencies.downstream[t]&&this.dependencies.downstream[t].forEach(s=>{this.selectedOperations.add(s.op.id)}),this.dependencies.upstream[t]&&this.dependencies.upstream[t].forEach(s=>{this.selectedOperations.add(s.op.id)}),console.log(`Clicked operation: ${t}`),console.log("Selected operations:",[...this.selectedOperations]),this.onOperationSelect(this.hoveredOperation,this.selectedOperations),this.render()}addPeerDependencies(e){const t=this.findOperationById(e);if(t){if(t.type==="compute"){const s=this.findOperationByProperties({type:"loads",address:t.address,ts:t.ts-1}),i=this.findOperationByProperties({type:"stores",address:t.address,ts:t.ts+1});s&&this.selectedOperations.add(s.id),i&&this.selectedOperations.add(i.id)}else if(t.type==="loads"||t.type==="stores"){const s=this.findOperationByProperties({type:"compute",address:t.address,ts:t.type==="loads"?t.ts+1:t.ts-1});s&&this.selectedOperations.add(s.id)}}}findOperationAt(e,t){if(!this.data)return null;const[s,i]=this.screenToWorld(e,t),{startTs:o,endTs:a}=this.getVisibleTimeStepRange(2);for(let l=o;l<=a;l++){const r=this.data[l];if(r)for(const h of["stores","compute","loads"]){if(!r[h]||!r[h].length)continue;const d=this.lanes.findIndex(w=>w.id===h);if(d===-1)continue;const c=this.RECT_COORDS.LANE_HEIGHT*this.RECT_COORDS.RECT_HEIGHT_RATIO,f=this.RECT_COORDS.LANE_START_Y+d*this.RECT_COORDS.LANE_HEIGHT+c,p=f+c,R=window.devicePixelRatio||1;if(i*R<f||i*R>p)continue;const y=r[h].length,O=1/y;for(let w=0;w<y;w++){const g=r[h][w],S=l+w*O,L=S+O;if(s>=S&&s<=L)return{op:g,type:h,ts:l}}}}return null}calculateStepInterval(e){this.canvas.width-100;const s=Math.ceil(80/(this.timeStepBaseWidth*this.zoomLevel));return s<1?1:s>10?10*Math.ceil(s/10):s}findOperationById(e){if(!this.data)return null;for(let t=0;t<this.data.length;t++){const s=this.data[t];for(const i of["stores","compute","loads"])if(s[i]){const o=s[i].find(a=>a.id===e);if(o)return{op:o,type:i,ts:t}}}return null}updateTooltip(e,t){if(this.tooltipElement)if(this.hoveredOperation){const s=this.hoveredOperation.op,i=this.hoveredOperation.type;this.tooltipElement.innerHTML=`
        <div class="tooltip-title">Op</div>
        <div><span>ID:</span> ${s.id}</div>
        <div><span>Operation:</span> ${s.operation||"N/A"}</div>
        <div><span>Type:</span> ${i}</div>
        <div><span>TS:</span> ${this.hoveredOperation.ts}</div>
        <div><span>Duration:</span> ${Math.max(1,s.hold_in_lmem||0)} time steps</div>
        <div><span>Target:</span> ${s.target||"N/A"}</div>
      `,this.tooltipElement.style.left=`${e+15}px`,this.tooltipElement.style.top=`${t+15}px`,this.tooltipElement.classList.add("show")}else this.tooltipElement.classList.remove("show")}lightenColor(e,t){return[Math.min(1,e[0]+t),Math.min(1,e[1]+t),Math.min(1,e[2]+t),e[3]]}zoomIn(){this.zoomLevel=Math.min(this.maxZoom,this.zoomLevel+.2),this.render()}zoomOut(){this.zoomLevel=Math.max(this.minZoom,this.zoomLevel-.2),this.render()}resetZoom(){this.zoomLevel=1,this.viewOffset=0,this.render()}destroy(){this.animationFrame&&cancelAnimationFrame(this.animationFrame),this.gl&&(this.gl.deleteProgram(this.program),this.gl.deleteProgram(this.overlayProgram),Object.values(this.buffers).forEach(e=>this.gl.deleteBuffer(e)),this.gl.deleteTexture(this.overlayTexture)),this.canvas.removeEventListener("wheel",this.handleWheel),this.canvas.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("mousedown",this.handleMouseDown),this.canvas.removeEventListener("mouseup",this.handleMouseUp),this.canvas.removeEventListener("mouseleave",this.handleMouseLeave),this.canvas.removeEventListener("click",this.handleClick),window.removeEventListener("resize",this.resize)}logPoint(e,t,s){const[i,o]=this.worldToPhysical(t,s);console.log(`${e} | world(${t}, ${s}) -> phys(${i.toFixed(1)}, ${o.toFixed(1)})`)}worldToPhysical(e,t){const[s,i]=this.worldToScreen(e,t);return[s,i]}getVisibleTimeStepRange(e=1){const t=window.devicePixelRatio||1,s=this.fixedLeft;if(!this.data)return{startTs:0,endTs:0};const i=(this.canvas.width-s*t)/(this.timeStepBaseWidth*this.zoomLevel*t),o=Math.max(0,Math.floor(this.viewOffset-e)),a=Math.min(this.data.length-1,Math.ceil(this.viewOffset+i+e));return{startTs:o,endTs:a}}debugCoordinateSystems(){console.log("坐标系调试:"),console.log("- Y轴屏幕位置:",this.fixedLeft),console.log("- 时间步0世界坐标: (0, 0)"),console.log("- 时间步0屏幕坐标:",this.worldToScreen(0,0)),console.log("- 视图偏移 viewOffset:",this.viewOffset),console.log("- 画布宽度:",this.canvas.width)}}const jn={class:"timestep-view"},qn={class:"toolbar"},Kn={class:"visualization-area"},Zn={key:0,class:"stats-panel"},Qn={__name:"timestep-view",setup(n){const e=G(null),t=G(null),s=G(null),i=G(null),o=G(null),a=I(()=>i.value?.length||0),l=I(()=>i.value?.reduce((w,g)=>w+(g.compute?.length||0),0)||0),r=I(()=>i.value?.reduce((w,g)=>w+(g.loads?.length||0),0)||0),h=I(()=>i.value?.reduce((w,g)=>w+(g.stores?.length||0),0)||0);Lt(async()=>{await st(),o.value=new Vn({canvas:e.value,tooltipElement:t.value,onOperationSelect:c,onOperationHover:f}),window.addEventListener("resize",O),O()}),bt(()=>{o.value?.destroy(),window.removeEventListener("resize",O)});function d(w){let g=w;if(w&&w.timestep&&(g=w.timestep),!g?.length){console.warn("[TimestepView] No valid timestep data received");return}i.value=g,o.value.setData(g),o.value.render()}function c(w,g){console.log("Operation selected:",w,g)}function f(w){}function p(){o.value?.zoomIn()}function R(){o.value?.zoomOut()}function y(){o.value?.resetZoom()}function O(){if(!s.value)return;const{width:w,height:g}=s.value.getBoundingClientRect();e.value.width=w,e.value.height=g,o.value?.render()}return(w,g)=>(Ee(),ge("div",jn,[b("div",qn,[oe(It,{onFileLoaded:d}),b("div",{class:"zoom-controls"},[b("button",{onClick:p},"+"),b("button",{onClick:R},"-"),b("button",{onClick:y},"Reset")])]),b("div",Kn,[b("div",{class:"main",ref_key:"main",ref:s},[b("canvas",{ref_key:"canvas",ref:e,class:"timestep-canvas"},null,512),b("div",{ref_key:"tooltip",ref:t,class:"tooltip"},null,512)],512)]),i.value?(Ee(),ge("div",Zn,[g[0]||(g[0]=b("h3",null,"时间步统计",-1)),b("p",null,"总时间步: "+ie(a.value),1),b("p",null,"compute操作: "+ie(l.value),1),b("p",null,"load操作: "+ie(r.value),1),b("p",null,"store操作: "+ie(h.value),1)])):Dt("",!0)]))}},Jn=et(Qn,[["__scopeId","data-v-0dfb2cb6"]]),es=[{path:"/",redirect:"/lmem"},{path:"/lmem",name:"lmem",component:Mt},{path:"/timestep",name:"timestep",component:Jn}],ts=zn({history:wn(),routes:es});console.log(">>> main.js 正在执行");kt(Ft).use(ts).mount("#app");
